{{!-- DASU Accuracy Roll Chat Message Template (Checks System) --}}
<div class="dasu roll-card {{result.type}}" data-item-id="{{item.id}}" data-actor-id="{{actor.id}}">

  {{!-- Combat-themed Header --}}
  <header class="roll-header">
    <div class="roll-title">
      <img class="item-image" src="{{item.img}}" alt="{{item.name}}" />
      <div class="title-info">
        <h3 class="item-name">{{checkLabel}}</h3>
      </div>
    </div>
    <div class="item-type">
      <span class="type-label">
        {{#if (and (eq item.type "ability") item.system.category)}}
          {{capitalize item.system.category}}
        {{else}}
          {{capitalize item.type}}
        {{/if}}
      </span>
    </div>
  </header>

  {{!-- Combat Dice Display --}}
  <div class="dice-container">
    {{#if result.additionalData.diceWithStatus}}
      {{!-- Show all dice for advantage/disadvantage rolls --}}
      {{#each result.additionalData.diceWithStatus}}
        <div class="die {{#if dropped}}dropped{{/if}}">
          {{value}}
          {{#if dropped}}<span class="drop-indicator">âœ•</span>{{/if}}
        </div>
      {{/each}}
    {{else}}
      {{!-- Fallback for normal rolls --}}
      {{#each result.additionalData.rollResults}}
        <div class="die">{{this}}</div>
      {{/each}}
    {{/if}}
    <div class="modifier">
      {{#if (gt result.additionalData.totalBonus 0)}}
        <span class="bonus">+{{result.additionalData.totalBonus}}</span>
      {{else if (lt result.additionalData.totalBonus 0)}}
        <span class="penalty">{{result.additionalData.totalBonus}}</span>
      {{/if}}
    </div>
  </div>

  {{!-- Formula breakdown --}}
  <div class="formula-breakdown">
    <span class="formula-display">{{result.roll.formula}}</span>
    {{#if result.flatBonus}}
      {{#if (ne result.flatBonus 0)}}
        <span class="modifier-breakdown">
          (Base: {{#if (gt result.flatBonus 0)}}+{{/if}}{{result.flatBonus}}{{#if (ne result.modifierTotal 0)}}, Mod: {{#if (gt result.modifierTotal 0)}}+{{/if}}{{result.modifierTotal}}{{/if}})
        </span>
      {{/if}}
    {{/if}}
  </div>

  {{!-- Combat Result Badge --}}
  <div class="outcome-compact">
    <div class="result-badge">
      {{#if result.autoSuccess}}
        <span class="result-value auto-success">AUTO SUCCESS</span>
        <span class="result-icon">
          <i class="fas fa-infinity"></i> {{localize "DASU.RollCard.NeverMiss"}}
        </span>
      {{else}}
        <span class="result-value">{{result.finalResult}}</span>
        <span class="result-icon">
          {{#if (eq item.type "tactic")}}
            <i class="fas fa-crosshairs"> {{localize "DASU.RollCard.vsDefense"}}</i>
          {{else}}
            <i class="fas fa-crosshairs"> {{localize "DASU.RollCard.vsAvoid"}}</i>
          {{/if}}
        </span>
      {{/if}}
    </div>
    <button type="button" class="breakdown-toggle" data-action="toggleBreakdown" data-tooltip="{{localize 'DASU.Checks.Breakdown'}}">
      <i class="fas fa-cog"></i>
    </button>
    {{#if result.critical}}
      <div class="crit-indicator">
        <span class="crit-icon"><i class="fas fa-star"></i></span>
        <span class="crit-text">{{localize "DASU.Crit"}}</span>
      </div>
    {{/if}}
  </div>

  {{!-- Breakdown section (hidden by default) --}}
  <div class="breakdown-section" style="display: none;">
    <div class="breakdown-content">
      <h4>{{localize "DASU.Checks.DiceBreakdown"}}</h4>
      <div class="breakdown-item">
        <span class="label">{{localize "DASU.RollCard.BaseDice"}}:</span>
        <span class="value">2d6</span>
      </div>
      {{#if result.additionalData.totalBonus}}
        <div class="breakdown-item">
          <span class="label">{{localize "DASU.RollCard.Modifier"}}:</span>
          <span class="value">+{{result.additionalData.totalBonus}}</span>
        </div>
      {{/if}}
      {{#if result.additionalData.diceWithStatus}}
        <div class="breakdown-item">
          <span class="label">{{localize "DASU.RollCard.DiceRolled"}}:</span>
          <span class="value">
            {{#each result.additionalData.diceWithStatus}}
              {{this.value}}{{#unless @last}}, {{/unless}}
            {{/each}}
          </span>
        </div>
      {{else if result.additionalData.rollResults}}
        <div class="breakdown-item">
          <span class="label">{{localize "DASU.RollCard.DiceRolled"}}:</span>
          <span class="value">
            {{#each result.additionalData.rollResults}}
              {{this}}{{#unless @last}}, {{/unless}}
            {{/each}}
          </span>
        </div>
      {{/if}}
      {{#if result.critical}}
        <div class="breakdown-item">
          <span class="label">{{localize "DASU.RollCard.Critical"}}:</span>
          <span class="value">{{localize "DASU.RollCard.Yes"}}</span>
        </div>
      {{/if}}
      <div class="breakdown-total">
        <span class="label">{{localize "DASU.RollCard.TotalRoll"}}:</span>
        <span class="value">{{result.finalResult}}</span>
      </div>
    </div>
  </div>

    {{!-- Item-Specific Information --}}
    {{#if (eq item.type "weapon")}}
      <div class="weapon-details">
        {{#if item.system.description}}
          <div class="description-info">
            <span class="description-text">{{{item.system.description}}}</span>
          </div>
        {{/if}}
        {{#if item.system.damage}}
          <div class="damage-info">
            <span class="damage-label">{{localize "DASU.RollCard.Damage"}}:</span>
            <span class="damage-value">{{item.system.damage.value}}</span>
            <span class="damage-type">{{capitalize item.system.damage.type}}</span>
          </div>
        {{/if}}
      </div>
    {{/if}}

    {{#if (eq item.type "ability")}}
      <div class="ability-details">
        {{#if item.system.description}}
          <div class="description-info">
            <span class="description-text">{{{item.system.description}}}</span>
          </div>
        {{/if}}
        {{#if item.system.cost}}
          <div class="cost-info">
            <div class="cost-text">
              <span class="cost-label">{{localize "DASU.RollCard.Cost"}}:</span>
              <span class="cost-value">{{item.system.cost}} {{upper item.system.costType}}</span>
            </div>
            <button type="button" class="pay-cost-btn" data-action="payCost" data-cost="{{item.system.cost}}" data-cost-type="{{item.system.costType}}" data-tooltip="{{localize 'DASU.RollCard.PayCost'}}">
              <i class="fas fa-minus-circle"></i>
            </button>
          </div>
        {{/if}}
        {{!-- Only show damage for spell and technique categories --}}
        {{#if (or (eq item.system.category "spell") (eq item.system.category "technique"))}}
          {{#if item.system.damage}}
            <div class="damage-info">
              <span class="damage-label">{{localize "DASU.RollCard.Damage"}}:</span>
              <span class="damage-value">{{item.system.damage.value}}</span>
              <span class="damage-type">{{capitalize item.system.damage.type}}</span>
            </div>
          {{/if}}
        {{/if}}
        {{#if (eq item.system.category "restorative")}}
          {{#if item.system.healed}}
            <div class="healing-info">
              <span class="healing-label">{{localize "DASU.RollCard.Restores"}}:</span>
              <span class="healing-value">{{item.system.healed.value}} {{upper item.system.healed.type}}</span>
            </div>
          {{/if}}
        {{/if}}
        {{#if item.system.effect}}
          <div class="effect-info">
            <span class="effect-label">{{localize "DASU.RollCard.Effect"}}:</span>
            <span class="effect-text">{{item.system.effect}}</span>
          </div>
        {{/if}}
      </div>
    {{/if}}

    {{#if (eq item.type "tactic")}}
      <div class="tactic-details">
        {{#if item.system.description}}
          <div class="description-info">
            <span class="description-text">{{{item.system.description}}}</span>
          </div>
        {{/if}}
        {{#if item.system.cost}}
          <div class="cost-info">
            <div class="cost-text">
              <span class="cost-label">{{localize "DASU.RollCard.Cost"}}:</span>
              <span class="cost-value">{{item.system.cost}} {{localize "DASU.Labels.willPoints"}}</span>
            </div>
            <button type="button" class="pay-cost-btn" data-action="payCost" data-cost="{{item.system.cost}}" data-cost-type="wp" data-tooltip="{{localize 'DASU.RollCard.PayCost'}}">
              <i class="fas fa-minus-circle"></i>
            </button>
          </div>
        {{/if}}
        {{#if item.system.damage}}
          <div class="damage-info">
            <span class="damage-label">{{localize "DASU.RollCard.Damage"}}:</span>
            <span class="damage-value">{{item.system.damage.value}}</span>
            <span class="damage-type">{{capitalize item.system.damage.type}}</span>
          </div>
        {{/if}}
        {{#if item.system.effect}}
          <div class="effect-info">
            <span class="effect-label">{{localize "DASU.RollCard.Effect"}}:</span>
            <span class="effect-text">{{item.system.effect}}</span>
          </div>
        {{/if}}
      </div>
    {{/if}}

  </div>

  {{!-- Footer --}}
  <footer class="roll-footer">
    <div class="roll-metadata">
      <span class="roll-type">{{capitalize result.type}} {{localize "DASU.Checks.Roll"}}{{#if result.isReroll}} (Reroll){{/if}}</span>
      <span class="message-type">
        {{#if (eq rollMode "public")}}{{localize "DASU.MessageTypes.public"}}{{/if}}
        {{#if (eq rollMode "gmroll")}}{{localize "DASU.MessageTypes.gmroll"}}{{/if}}
        {{#if (eq rollMode "blindroll")}}{{localize "DASU.MessageTypes.blindroll"}}{{/if}}
        {{#if (eq rollMode "selfroll")}}{{localize "DASU.MessageTypes.selfroll"}}{{/if}}
      </span>
    </div>
  </footer>

</div>