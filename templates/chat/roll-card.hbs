{{!-- DASU Roll Chat Message Template --}}
<div class="dasu roll-card {{roll.rollType}}" data-item-id="{{roll.item.id}}" data-actor-id="{{roll.actor.id}}">
  
  {{!-- Combat-themed Header --}}
  <header class="roll-header">
    <div class="roll-title">
      <img class="item-image" src="{{roll.item.img}}" alt="{{roll.item.name}}" />
      <div class="title-info">
        <h3 class="item-name">{{roll.rollLabel}}</h3>
      </div>
    </div>
    <div class="item-type">
      <span class="type-label">
        {{#if (and (eq roll.item.type "ability") roll.item.system.category)}}
          {{capitalize roll.item.system.category}}
        {{else}}
          {{capitalize roll.item.type}}
        {{/if}}
      </span>
    </div>
  </header>

  {{!-- Combat Dice Display --}}
  <div class="dice-container">
    {{#if roll.results.diceWithStatus}}
      {{!-- Show all dice for advantage/disadvantage rolls --}}
      {{#each roll.results.diceWithStatus}}
        <div class="die {{#if dropped}}dropped{{/if}}">
          {{value}}
          {{#if dropped}}<span class="drop-indicator">âœ•</span>{{/if}}
        </div>
      {{/each}}
    {{else}}
      {{!-- Fallback for normal rolls --}}
      {{#each roll.results.rollResults}}
        <div class="die">{{this}}</div>
      {{/each}}
    {{/if}}
    <div class="modifier">
      {{#if (gt roll.totalBonus 0)}}
        <span class="bonus">+{{roll.totalBonus}}</span>
      {{else if (lt roll.totalBonus 0)}}
        <span class="penalty">{{roll.totalBonus}}</span>
      {{/if}}
    </div>
  </div>
  
  {{!-- Formula breakdown --}}
  <div class="formula-breakdown">
    <span class="formula-display">{{roll.results.formula}}</span>
    {{#if roll.bonusModifier}}
      {{#if (ne roll.bonusModifier 0)}}
        <span class="modifier-breakdown">
          (Base: {{#if (gt roll.bonus 0)}}+{{/if}}{{roll.bonus}}{{#if (ne roll.bonusModifier 0)}}, Mod: {{#if (gt roll.bonusModifier 0)}}+{{/if}}{{roll.bonusModifier}}{{/if}})
        </span>
      {{/if}}
    {{/if}}
  </div>

  {{!-- Combat Result Badge --}}
  <div class="outcome-compact">
    <div class="result-badge">
      <span class="result-value">{{roll.results.total}}</span>
      <span class="result-icon">
        {{#if isTactic}}
          <i class="fas fa-crosshairs"> {{localize "DASU.RollCard.vsDefense"}}</i>
        {{else}}
          <i class="fas fa-crosshairs"> {{localize "DASU.RollCard.vsAvoid"}}</i>
        {{/if}}
      </span>
    </div>
    {{#if hasCrit}}
      <div class="crit-indicator">
        <span class="crit-icon"><i class="fas fa-star"></i></span>
        <span class="crit-text">{{localize "DASU.Crit"}}</span>
      </div>
    {{/if}}
  </div>

    {{!-- Item-Specific Information --}}
    {{#if isWeapon}}
      <div class="weapon-details">
        {{#if roll.item.system.description}}
          <div class="description-info">
            <span class="description-text">{{{roll.item.system.description}}}</span>
          </div>
        {{/if}}
        {{#if roll.results.damage}}
          <div class="damage-info">
            <span class="damage-label">{{localize "DASU.RollCard.Damage"}}:</span>
            <span class="damage-value">{{roll.results.damage.value}}</span>
            <span class="damage-type">{{capitalize roll.results.damage.type}}</span>
          </div>
        {{/if}}
        {{#if roll.item.system.cost}}
          <div class="cost-info">
            <span class="cost-label">{{localize "DASU.RollCard.Cost"}}:</span>
            <span class="cost-value">{{roll.item.system.cost}} {{localize "DASU.Labels.willPoints"}}</span>
          </div>
        {{/if}}
      </div>
    {{/if}}

    {{#if isAbility}}
      <div class="ability-details">
        {{#if roll.item.system.description}}
          <div class="description-info">
            <span class="description-text">{{{roll.item.system.description}}}</span>
          </div>
        {{/if}}
        {{#if roll.results.cost}}
          <div class="cost-info">
            <span class="cost-label">{{localize "DASU.RollCard.Cost"}}:</span>
            <span class="cost-value">{{roll.results.cost.value}} {{upper roll.results.cost.type}}</span>
          </div>
        {{/if}}
        {{!-- Only show damage for spell and technique categories --}}
        {{#if (or (eq roll.item.system.category "spell") (eq roll.item.system.category "technique"))}}
          {{#if roll.results.damage}}
            <div class="damage-info">
              <span class="damage-label">{{localize "DASU.RollCard.Damage"}}:</span>
              <span class="damage-value">{{roll.results.damage.value}}</span>
              <span class="damage-type">{{capitalize roll.results.damage.type}}</span>
            </div>
          {{/if}}
        {{/if}}
        {{#if roll.results.healing}}
          <div class="healing-info">
            <span class="healing-label">{{localize "DASU.RollCard.Restores"}}:</span>
            <span class="healing-value">{{roll.results.healing.value}} {{upper roll.results.healing.type}}</span>
          </div>
        {{/if}}
        {{#if roll.item.system.effect}}
          <div class="effect-info">
            <span class="effect-label">{{localize "DASU.RollCard.Effect"}}:</span>
            <span class="effect-text">{{roll.item.system.effect}}</span>
          </div>
        {{/if}}
      </div>
    {{/if}}

    {{#if isTactic}}
      <div class="tactic-details">
        {{#if roll.item.system.description}}
          <div class="description-info">
            <span class="description-text">{{{roll.item.system.description}}}</span>
          </div>
        {{/if}}
        {{#if roll.results.cost}}
          <div class="cost-info">
            <span class="cost-label">{{localize "DASU.RollCard.Cost"}}:</span>
            <span class="cost-value">{{roll.results.cost.value}} {{localize "DASU.Labels.willPoints"}}</span>
          </div>
        {{/if}}
        {{#if roll.results.damage}}
          <div class="damage-info">
            <span class="damage-label">{{localize "DASU.RollCard.Damage"}}:</span>
            <span class="damage-value">{{roll.results.damage.value}}</span>
            <span class="damage-type">{{capitalize roll.results.damage.type}}</span>
          </div>
        {{/if}}
        {{#if roll.results.effect}}
          <div class="effect-info">
            <span class="effect-label">{{localize "DASU.RollCard.Effect"}}:</span>
            <span class="effect-text">{{roll.results.effect}}</span>
          </div>
        {{/if}}
      </div>
    {{/if}}

  </div>

  {{!-- Footer --}}
  <footer class="roll-footer">
    <div class="roll-metadata">
      <span class="roll-type">{{capitalize roll.rollType}} Roll</span>
      <span class="message-type">
        {{#if (eq rollMode "public")}}{{localize "DASU.MessageTypes.public"}}{{/if}}
        {{#if (eq rollMode "gmroll")}}{{localize "DASU.MessageTypes.gmroll"}}{{/if}}
        {{#if (eq rollMode "blindroll")}}{{localize "DASU.MessageTypes.blindroll"}}{{/if}}
        {{#if (eq rollMode "selfroll")}}{{localize "DASU.MessageTypes.selfroll"}}{{/if}}
      </span>
    </div>
  </footer>

</div>