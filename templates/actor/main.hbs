{{! Main Tab }}
<section
  class='tab main scrollable {{tab.cssClass}}'
  data-group='primary'
  data-tab='main'
>
  <section class='grid grid-3col'>
    <aside class='sidebar grid-span-1'>
      <div></div>
      {{#if (or (eq actor.type 'summoner') (eq actor.type 'daemon'))}}
        {{! DASU Attributes for Daemons and Summoners }}
        {{#if (eq actor.type 'daemon')}}
          {{! Compact layout for Daemons }}
          {{! Attribute Points Display - Header above grid }}
          <div class="attribute-points-display flexrow">
            <label class="resource-label flex1">{{localize 'DASU.Actor.Attributes.points.label.label'}}</label>
            <span class="tick-button-compact" data-tooltip="{{localize 'DASU.Actor.Attributes.points.tooltip'}}">
              AP: {{apSpent}} / {{apEarned}}
            </span>
          </div>
          
          <div class='skills-section attributes grid grid-2col'>
            {{! Individual Attributes - 2 per row for compact daemon layout }}
            {{#each system.attributes as |attribute key|}}
              <div class='attribute flexrow flex-group-center'>
                <div class='attribute-header flexrow flex-group-center'>
                  <div class='attribute-name'>
                    {{localize (concat "DASU.Actor.Attributes.list." key ".abbr")}}
                  </div>
                  <div class='tick-button rollable attribute-value'
                       data-action='roll'
                       data-roll='{{attribute.tick}}d6'
                       data-attribute='{{key}}'
                       data-label='{{localize (concat "DASU.Actor.Attributes.list." key ".label")}} Check ({{attribute.tick}} dice)'>
                    {{attribute.tick}}
                  </div>
                </div>
                {{#if @root.isEditMode}}
                  <div class='attribute-controls flexrow'>
                    <button type='button' 
                            class='attribute-decrease' 
                            data-action='decreaseAttribute' 
                            data-attribute='{{key}}'
                            {{#if (eq attribute.tick 1)}}disabled{{/if}}>
                      <i class='fas fa-minus'></i>
                    </button>
                    <button type='button' 
                            class='attribute-increase' 
                            data-action='increaseAttribute' 
                            data-attribute='{{key}}'
                            {{#if (or (eq attribute.tick 6) (eq ../apUnspent 0))}}disabled{{/if}}>
                      <i class='fas fa-plus'></i>
                    </button>
                  </div>
                {{/if}}
              </div>
            {{/each}}
          </div>

          {{! Critical Modifier Section for Daemons }}
          <div class="crit-section">
            <div class="crit-header flexrow">
              <label class="resource-label flex2">{{localize 'DASU.Actor.Stats.crit.label'}}</label>
              <span class="crit-threshold-display" data-tooltip="{{localize 'DASU.Actor.Stats.crit.tooltipDaemon' value=system.stats.crit.value}}">
                {{localize 'DASU.Actor.Stats.crit.threshold'}}: {{system.stats.crit.value}}
              </span>
            </div>
            {{#if @root.isEditMode}}
              <div class="crit-controls flexrow">
                <label class="crit-label">{{localize 'DASU.Actor.Stats.crit.mod'}}:</label>
                <input type="number" 
                       name="system.stats.crit.mod" 
                       value="{{system.stats.crit.mod}}" 
                       min="0" 
                       max="6" 
                       data-dtype="Number" 
                       class="crit-mod-input"
                       data-tooltip="{{localize 'DASU.Actor.Stats.crit.modTooltip'}}" />
              </div>
            {{else}}
              <div class="crit-display flexrow">
                <label class="crit-label">{{localize 'DASU.Actor.Stats.crit.mod'}}:</label>
                <span class="crit-value">{{system.stats.crit.mod}}</span>
              </div>
            {{/if}}
          </div>

          {{! Moral Triad Section for Daemons }}
          <div class='card-container' style='background: var(--color-bg-primary); border: 1px solid var(--color-border); padding: 0.2rem 0.4rem; align-items: center; min-height: 1.4rem; margin-bottom: 0.5rem;'>
            <h4 class="section-header">{{localize 'DASU.Actor.Triad.Header'}}</h4>
            <div class="triad-field flexrow">
              <label class="resource-label">{{localize 'DASU.Actor.Triad.Virtue'}}:</label>
              <span class="field-value">{{system.triad.virtue}}</span>
            </div>
            <div class="triad-field flexrow">
              <label class="resource-label">{{localize 'DASU.Actor.Triad.Sin'}}:</label>
              <span class="field-value">{{system.triad.sin}}</span>
            </div>
            <div class="triad-field flexrow">
              <label class="resource-label">{{localize 'DASU.Actor.Triad.Anathema'}}:</label>
              <span class="field-value">{{system.triad.anathema}}</span>
            </div>
          </div>

          {{! Biography Section for Daemons }}
          <div class='card-container' style='background: var(--color-bg-primary); border: 1px solid var(--color-border); padding: 0.2rem 0.4rem; align-items: center; min-height: 1.4rem; margin-bottom: 0.5rem;'>
            <h4 class="section-header">{{systemFields.biography.label}}</h4>
            <div class="biography-content">
              {{{enrichedBiography}}}
            </div>
          </div>
        {{else}}
          {{! Standard layout for Summoners }}
          {{! Attribute Points Display - Header above grid }}
          <div class="attribute-points-display flexrow">
            <label class="resource-label flex1">{{localize 'DASU.Actor.Attributes.points.label.label'}}</label>
            <span class="tick-button-compact" data-tooltip="{{localize 'DASU.Actor.Attributes.points.tooltip'}}">
              AP: {{apSpent}} / {{apEarned}}
            </span>
          </div>
          
          <div class='skills-section attributes grid grid-2col'>
            {{! Individual Attributes - 2 per row }}
            {{#each system.attributes as |attribute key|}}
              <div class='attribute flexrow flex-group-center'>
                <div class='attribute-header flexrow flex-group-center'>
                  <div class='attribute-name'>
                    {{localize (concat "DASU.Actor.Attributes.list." key ".abbr")}}
                  </div>
                  <div class='tick-button rollable attribute-value'
                       data-action='roll'
                       data-roll='{{attribute.tick}}d6'
                       data-attribute='{{key}}'
                       data-label='{{localize (concat "DASU.Actor.Attributes.list." key ".label")}} Check ({{attribute.tick}} dice)'>
                    {{attribute.tick}}
                  </div>
                </div>
                {{#if @root.isEditMode}}
                  <div class='attribute-controls flexrow'>
                    <button type='button' 
                            class='attribute-decrease' 
                            data-action='decreaseAttribute' 
                            data-attribute='{{key}}'
                            {{#if (eq attribute.tick 1)}}disabled{{/if}}>
                      <i class='fas fa-minus'></i>
                    </button>
                    <button type='button' 
                            class='attribute-increase' 
                            data-action='increaseAttribute' 
                            data-attribute='{{key}}'
                            {{#if (or (eq attribute.tick 6) (eq ../apUnspent 0))}}disabled{{/if}}>
                      <i class='fas fa-plus'></i>
                    </button>
                  </div>
                {{/if}}
              </div>
            {{/each}}
          </div>

          {{! Critical Modifier Section for Summoners }}
          <div class="crit-section">
            <div class="crit-header flexrow">
              <label class="resource-label flex2">{{localize 'DASU.Actor.Stats.crit.label'}}</label>
              <span class="crit-threshold-display" data-tooltip="{{localize 'DASU.Actor.Stats.crit.tooltipSummoner' value=system.stats.crit.value}}">
                {{localize 'DASU.Actor.Stats.crit.threshold'}}: {{system.stats.crit.value}}
              </span>
            </div>
            {{#if @root.isEditMode}}
              <div class="crit-controls flexrow">
                <label class="crit-label">{{localize 'DASU.Actor.Stats.crit.mod'}}:</label>
                <input type="number" 
                       name="system.stats.crit.mod" 
                       value="{{system.stats.crit.mod}}" 
                       min="0" 
                       max="6" 
                       data-dtype="Number" 
                       class="crit-mod-input"
                       data-tooltip="{{localize 'DASU.Actor.Stats.crit.modTooltip'}}" />
              </div>
            {{else}}
              <div class="crit-display flexrow">
                <label class="crit-label">{{localize 'DASU.Actor.Stats.crit.label'}}:</label>
                <span class="crit-value">{{system.stats.crit.mod}}</span>
              </div>
            {{/if}}
          </div>

          {{! Skills Section for Summoners }}
          {{! Skill Points Display - Header above skills }}
          <div class="skill-points-display flexrow">
            <label class="resource-label flex1">{{localize 'DASU.Actor.Skills.skillPoints.label'}}</label>
            <span class="tick-button-compact" data-tooltip="{{localize 'DASU.Actor.Skills.skillPoints.tooltip'}}">
              {{localize 'DASU.Actor.Skills.skillPoints.abbr'}}: {{skillPoints.spent}}/{{skillPoints.max}}
            </span>
          </div>
          
          <div class='skills-section'>
            {{! Skills Grid }}
            <div class='skills'>
              {{#each skills as |skill index|}}
                <div class='skill flexcol'>
                  {{! Skill Name and Governing Attribute - Left Aligned }}
                  <div class='skill-header flexrow flex-group-center'>
                    <div class='skill-name'>{{skill.name}} ({{uppercase skill.govern}})</div>
                    
                    {{! Tick Number - Right Aligned }}
                    <div class='tick-button rollable' 
                         data-action='roll' 
                         data-roll='{{skill.ticks}}d6 + {{lookup system.attributes skill.govern "tick"}}d6'
                         data-label='{{skill.name}} Check ({{localize (concat "DASU.Actor.Attributes.list." skill.govern ".label")}}: {{lookup system.attributes skill.govern "tick"}} tick | Skill: {{skill.ticks}} tick)'>
                      {{skill.ticks}}
                    </div>
                  </div>
                  
                  {{! Tick Boxes (1-6) - Only show in edit mode }}
                  {{#if @root.isEditMode}}
                    <div class='skill-ticks flexrow'>
                      {{#each (range 1 6) as |tick|}}
                        <input type='radio' 
                               value='{{tick}}' 
                               {{#if (eq skill.ticks tick)}}checked{{/if}}
                               {{#if (lte tick skill.ticks)}}filled{{/if}}
                               class='skill-tick-radio{{#if (lte tick skill.ticks)}} filled{{/if}}'
                               data-tooltip='<div style="text-align: center;">{{tick}} Ticks<br>Cost {{subtract (lookup @root.skillCosts tick) (lookup @root.skillCosts skill.ticks)}} SP<br><small>Right-click to reset to 0</small></div>'
                               data-skill-index='{{index}}'
                               data-tick-value='{{tick}}' />
                      {{/each}}
                    </div>
                  {{/if}}
                </div>
              {{/each}}
            </div>
          </div>
        {{/if}}
      {{else}}
        {{! Standard Abilities for other actor types }}
        <div class='abilities flexcol'>
          {{#each system.abilities as |ability key|}}
            <div class='ability flexrow flex-group-center'>
              <label class='resource-label flexlarge align-left'>{{localize (lookup @root.config.abilities key)}}</label>
              {{#if @root.isEditMode}}
                <input
                  type='text'
                  name='system.abilities.{{key}}.value'
                  value='{{ability.value}}'
                  class="ability-score"
                  data-dtype='Number'
                />
              {{else}}
                <span class="ability-score-label">{{ability.value}}</span>
              {{/if}}
              <span
                class='ability-mod rollable'
                data-action='roll'
                data-roll='d20+@abilities.{{key}}.mod'
                data-label='{{localize (lookup @root.config.abilities key)}}'
              >{{numberFormat ability.mod decimals=0 sign=true}}</span>
            </div>
          {{/each}}
        </div>
      {{/if}}
    </aside>

    <main class='main-content grid-span-2'>
      {{! Summoned Daemons Section (only for summoners) }}
      {{#if (eq actor.type 'summoner')}}
        <aside class='summoned-daemons'>
          <ol class='items-list'>
            <li class='item flexrow items-header collapse-toggle' data-action='toggleSummonedDaemons'>
              <div class='item-name gap-xs'>
                <i class='fas {{#if summonedDaemonsCollapsed}}fa-chevron-down{{else}}fa-chevron-up{{/if}}'></i>
                {{localize 'DASU.Actor.Main.SummonedDaemons'}}
              </div>
            </li>
            {{#if summonedDaemonsCollapsed}}
              {{#if summonedDaemons.length}}
                <div class='item-list summoned-daemons-list'>
                  {{#each summonedDaemons as |daemon id|}}
                    <li class='item summoned-daemon flexcol' data-actor-id='{{daemon._id}}' data-document-class='Actor'>
                      {{! First row - main info }}
                      <div class='daemon-main-row flexrow'>
                        <div class='item-image daemon-image'>
                          <a class='rollable' data-roll-type='actor' data-action='roll' data-tooltip='{{localize "DOCUMENT.Update" type='daemon'}}'>
                            <img src='{{daemon.img}}' data-tooltip='{{daemon.name}}' width='32' height='32'/>
                          </a>
                        </div>
                        <div class='item-name daemon-info flexcol'>
                          <div class='daemon-name'>{{daemon.name}}</div>
                        </div>
                        <div class='item-controls daemon-controls'>
                          <a class='item-control daemon-control'
                             data-action='viewDoc'
                             data-tooltip='{{localize "DOCUMENT.Update" type='daemon'}}'>
                            <i class='fas fa-edit'></i>
                          </a>
                        </div>
                      </div>
                      {{! Second row - stats }}
                      <div class='daemon-stats-row flexrow'>
                        <div class='daemon-stat-badge'>
                          <span class='stat-label'>{{localize 'DASU.Actor.Stats.hp.label'}}</span>
                          <span class='stat-value'>{{daemon.system.stats.hp.current}}/{{daemon.system.stats.hp.max}}</span>
                        </div>
                        <div class='daemon-stat-badge'>
                          <span class='stat-label'>{{localize 'DASU.Actor.Stats.wp.label'}}</span>
                          <span class='stat-value'>{{daemon.system.stats.wp.current}}/{{daemon.system.stats.wp.max}}</span>
                        </div>
                        <div class='daemon-stat-badge'>
                          <span class='stat-label'>{{localize 'DASU.Labels.level'}}</span>
                          <span class='stat-value'>{{daemon.system.level}}</span>
                        </div>
                        {{! Attribute badges }}
                        {{#each daemon.system.attributes as |attribute key|}}
                          <div class='daemon-stat-badge attribute-badge rollable'
                               data-action='roll'
                               data-roll-type='daemon-attribute'
                               data-roll='{{attribute.tick}}d6'
                               data-label='{{daemon.name}} - {{localize (concat "DASU.Actor.Attributes.list." key ".label")}} Check ({{attribute.tick}} dice)'
                               data-actor-id='{{daemon._id}}'
                               data-attribute='{{key}}'>
                            <span class='stat-label'>{{localize (concat "DASU.Actor.Attributes.list." key ".abbr")}}</span>
                            <span class='stat-value'>{{attribute.tick}}</span>
                          </div>
                        {{/each}}
                        <div class='daemon-stat-badge'>
                          <span class='stat-label'>{{localize 'DASU.Actor.Stats.avoid.label'}}</span>
                          <span class='stat-value'>{{daemon.system.stats.avoid.value}}</span>
                        </div>
                        <div class='daemon-stat-badge'>
                          <span class='stat-label'>{{localize 'DASU.Actor.Stats.def.label'}}</span>
                          <span class='stat-value'>{{daemon.system.stats.def.value}}</span>
                        </div>
                      </div>
                    </li>
                  {{/each}}
                </div>
              {{else}}
                <li class='item flexrow no-summoned-daemons'>
                  <div class='item-name'>
                    {{localize 'DASU.Actor.Main.NoSummonedDaemons'}}
                  </div>
                </li>
              {{/if}}
            {{else}}
              {{! Expanded: show the full stocks list, grouped and styled }}
              <ol class='items-list'>
                <li class='item flexrow items-header'>
                  <div class='item-name'>{{localize 'DASU.Actor.Stocks.Title'}} — {{localize 'DASU.Actor.Stocks.Summoned'}}</div>
                </li>
                {{#each daemons as |daemon id|}}
                  {{#if daemon.isSummoned}}
                    <li class='item summoned-daemon flexcol' data-actor-id='{{daemon._id}}' data-document-class='Actor'>
                      {{! First row - name and basic info }}
                      <div class='daemon-main-row flexrow'>
                        <div class='item-name flexrow'>
                          <div class='item-image'>
                            <a class='rollable' data-roll-type='actor' data-action='roll'>
                              <img src='{{daemon.img}}' data-tooltip='{{daemon.name}}' width='24' height='24'/>
                            </a>
                          </div>
                          <div>{{daemon.name}}</div>
                        </div>
                        <div class='item-actions'>
                          <span class='summoned-status'>{{localize 'DASU.Actor.Stocks.Summoned'}}</span>
                        </div>
                        <div class='item-controls'>
                          <a class='item-control item-edit' data-tooltip='{{localize "DOCUMENT.Update" type='daemon'}}' data-action='viewDoc'>
                            <i class='fas fa-edit'></i>
                          </a>
                          <a class='item-control toggle-summoned' data-tooltip='{{localize "DASU.Actor.Stocks.ToggleSummoned"}}' data-action='toggleSummoned'>
                            <i class='fas fa-user-check'></i>
                          </a>
                          <a class='item-control item-delete' data-tooltip='{{localize "DASU.Actor.Stocks.RemoveFromStock"}}' data-action='removeFromStock'>
                            <i class='fas fa-trash'></i>
                          </a>
                          {{!-- {{#if (and @root.editable @root.isEditMode)}} --}}
                          {{!-- {{/if}} --}}
                        </div>
                      </div>
                      {{! Second row - stats }}
                      <div class='daemon-stats-row flexrow'>
                        <div class='daemon-stat-badge'>
                          <span class='stat-label'>{{localize 'DASU.Actor.Stats.hp.label'}}</span>
                          <span class='stat-value'>{{daemon.system.stats.hp.current}}/{{daemon.system.stats.hp.max}}</span>
                        </div>
                        <div class='daemon-stat-badge'>
                          <span class='stat-label'>{{localize 'DASU.Actor.Stats.wp.label'}}</span>
                          <span class='stat-value'>{{daemon.system.stats.wp.current}}/{{daemon.system.stats.wp.max}}</span>
                        </div>
                        <div class='daemon-stat-badge'>
                          <span class='stat-label'>{{localize 'DASU.Labels.level'}}</span>
                          <span class='stat-value'>{{daemon.system.level}}</span>
                        </div>
                        {{! Attribute badges }}
                        {{#each daemon.system.attributes as |attribute key|}}
                          <div class='daemon-stat-badge attribute-badge rollable'
                               data-action='roll'
                               data-roll-type='daemon-attribute'
                               data-roll='{{attribute.tick}}d6'
                               data-label='{{daemon.name}} - {{localize (concat "DASU.Actor.Attributes.list." key ".label")}} Check ({{attribute.tick}} dice)'
                               data-actor-id='{{daemon._id}}'
                               data-attribute='{{key}}'>
                            <span class='stat-label'>{{localize (concat "DASU.Actor.Attributes.list." key ".abbr")}}</span>
                            <span class='stat-value'>{{attribute.tick}}</span>
                          </div>
                        {{/each}}
                        <div class='daemon-stat-badge'>
                          <span class='stat-label'>{{localize 'DASU.Actor.Stats.avoid.label'}}</span>
                          <span class='stat-value'>{{daemon.system.stats.avoid.value}}</span>
                        </div>
                        <div class='daemon-stat-badge'>
                          <span class='stat-label'>{{localize 'DASU.Actor.Stats.def.label'}}</span>
                          <span class='stat-value'>{{daemon.system.stats.def.value}}</span>
                        </div>
                      </div>
                    </li>
                  {{/if}}
                {{/each}}
                <li class='item flexrow items-header'>
                  <div class='item-name'>{{localize 'DASU.Actor.Stocks.Title'}} — {{localize 'DASU.Actor.Stocks.Unsummoned'}}</div>
                </li>
                {{#each daemons as |daemon id|}}
                  {{#unless daemon.isSummoned}}
                    <li class='item unsummoned-daemon flexcol' data-actor-id='{{daemon._id}}' data-document-class='Actor'>
                      {{! First row - name and basic info }}
                      <div class='daemon-main-row flexrow'>
                        <div class='item-name flexrow'>
                          <div class='item-image'>
                            <a class='rollable' data-roll-type='actor' data-action='roll'>
                              <img src='{{daemon.img}}' data-tooltip='{{daemon.name}}' width='24' height='24'/>
                            </a>
                          </div>
                          <div>{{daemon.name}}</div>
                        </div>
                        <div class='item-actions'>
                          <span class='unsummoned-status'>{{localize 'DASU.Actor.Stocks.Unsummoned'}}</span>
                        </div>
                        <div class='item-controls'>
                          <a class='item-control item-edit' data-tooltip='{{localize "DOCUMENT.Update" type='daemon'}}' data-action='viewDoc'>
                            <i class='fas fa-edit'></i>
                          </a>
                          <a class='item-control toggle-summoned' data-tooltip='{{localize "DASU.Actor.Stocks.ToggleSummoned"}}' data-action='toggleSummoned'>
                            <i class='fas fa-user-plus'></i>
                          </a>
                          <a class='item-control item-delete' data-tooltip='{{localize "DASU.Actor.Stocks.RemoveFromStock"}}' data-action='removeFromStock'>
                            <i class='fas fa-trash'></i>
                          </a>
                        </div>
                        {{!-- {{#if (and @root.editable @root.isEditMode)}} --}}
                        {{!-- {{/if}} --}}
                      </div>
                      {{! Second row - stats }}
                      <div class='daemon-stats-row flexrow'>
                        <div class='daemon-stat-badge'>
                          <span class='stat-label'>{{localize 'DASU.Actor.Stats.hp.label'}}</span>
                          <span class='stat-value'>{{daemon.system.stats.hp.current}}/{{daemon.system.stats.hp.max}}</span>
                        </div>
                        <div class='daemon-stat-badge'>
                          <span class='stat-label'>{{localize 'DASU.Actor.Stats.wp.label'}}</span>
                          <span class='stat-value'>{{daemon.system.stats.wp.current}}/{{daemon.system.stats.wp.max}}</span>
                        </div>
                        <div class='daemon-stat-badge'>
                          <span class='stat-label'>{{localize 'DASU.Labels.level'}}</span>
                          <span class='stat-value'>{{daemon.system.level}}</span>
                        </div>
                        {{! Attribute badges }}
                        {{#each daemon.system.attributes as |attribute key|}}
                          <div class='daemon-stat-badge attribute-badge rollable'
                               data-action='roll'
                               data-roll-type='daemon-attribute'
                               data-roll='{{attribute.tick}}d6'
                               data-label='{{daemon.name}} - {{localize (concat "DASU.Actor.Attributes.list." key ".label")}} Check ({{attribute.tick}} dice)'
                               data-actor-id='{{daemon._id}}'
                               data-attribute='{{key}}'>
                            <span class='stat-label'>{{localize (concat "DASU.Actor.Attributes.list." key ".abbr")}}</span>
                            <span class='stat-value'>{{attribute.tick}}</span>
                          </div>
                        {{/each}}
                        <div class='daemon-stat-badge'>
                          <span class='stat-label'>{{localize 'DASU.Actor.Stats.avoid.label'}}</span>
                          <span class='stat-value'>{{daemon.system.stats.avoid.value}}</span>
                        </div>
                        <div class='daemon-stat-badge'>
                          <span class='stat-label'>{{localize 'DASU.Actor.Stats.def.label'}}</span>
                          <span class='stat-value'>{{daemon.system.stats.def.value}}</span>
                        </div>
                      </div>
                    </li>
                  {{/unless}}
                {{/each}}
              </ol>
            {{/if}}
          </ol>
        </aside>
      {{/if}}

      {{! Items List Section }}
      <aside class='items-overview'>
        <ol class='items-list'>
          {{! Search and Filter Row }}
          <li class='item flexrow items-search-row'>
            <div class='search-container'>
              <input 
                type='text' 
                class='items-search-input' 
                placeholder='{{localize "DASU.SearchItems"}}'
                data-tooltip='{{localize "DASU.SearchItemsTooltip"}}'
              />
              <button class='search-clear' data-tooltip='{{localize "DASU.ClearSearch"}}'>
                <i class='fas fa-times'></i>
              </button>
            </div>
            <div class='filter-container flex-row'>
              <button class='items-sort-btn' data-tooltip='{{localize "DASU.Sort.Title"}}'>
                <i class='fas fa-sort'></i>
              </button>
              <button class='items-filter-btn' data-tooltip='{{localize "DASU.SortAndFilter"}}'>
                <i class='fas fa-filter'></i>
              </button>
              <div class='items-filter-dropdown'>
                <div class='filter-header'>
                  <span>{{localize "DASU.Filter.Title"}}</span>
                  <button class='select-all-btn'>{{localize "DASU.Filter.SelectAll"}}</button>
                </div>
                <div class='filter-options'>
                  <label class='filter-option'>
                    <input type='checkbox' value='weapon' checked>
                    <i class='fas fa-sword'></i>
                    <span>{{localize "DASU.Filter.Weapons"}}</span>
                  </label>
                  <label class='filter-option'>
                    <input type='checkbox' value='tag' checked>
                    <i class='fas fa-tag'></i>
                    <span>{{localize "DASU.Filter.Tags"}}</span>
                  </label>
                  <label class='filter-option'>
                    <input type='checkbox' value='technique' checked>
                    <i class='fas fa-fist-raised'></i>
                    <span>{{localize "DASU.Filter.Techniques"}}</span>
                  </label>
                  <label class='filter-option'>
                    <input type='checkbox' value='spell' checked>
                    <i class='fas fa-magic'></i>
                    <span>{{localize "DASU.Filter.Spells"}}</span>
                  </label>
                  <label class='filter-option'>
                    <input type='checkbox' value='affliction' checked>
                    <i class='fas fa-skull'></i>
                    <span>{{localize "DASU.Filter.Afflictions"}}</span>
                  </label>
                  <label class='filter-option'>
                    <input type='checkbox' value='restorative' checked>
                    <i class='fas fa-heart'></i>
                    <span>{{localize "DASU.Filter.Restoratives"}}</span>
                  </label>
                  <label class='filter-option'>
                    <input type='checkbox' value='tactic' checked>
                    <i class='fas fa-chess'></i>
                    <span>{{localize "DASU.Filter.Tactics"}}</span>
                  </label>
                  <label class='filter-option'>
                    <input type='checkbox' value='special' checked>
                    <i class='fas fa-star'></i>
                    <span>{{localize "DASU.Filter.Specials"}}</span>
                  </label>
                  {{#if (ne actor.type 'daemon')}}
                  <label class='filter-option'>
                    <input type='checkbox' value='scar' checked>
                    <i class='fas fa-scar'></i>
                    <span>{{localize "DASU.Filter.Scars"}}</span>
                  </label>
                  {{/if}}
                  {{#if (ne actor.type 'daemon')}}
                  <label class='filter-option'>
                    <input type='checkbox' value='schema' checked>
                    <i class='fas fa-cube'></i>
                    <span>{{localize "DASU.Filter.Schemas"}}</span>
                  </label>
                  <label class='filter-option'>
                    <input type='checkbox' value='feature' checked>
                    <i class='fas fa-gem'></i>
                    <span>{{localize "DASU.Filter.Features"}}</span>
                  </label>
                  <label class='filter-option'>
                    <input type='checkbox' value='class' checked>
                    <i class='fas fa-graduation-cap'></i>
                    <span>{{localize "DASU.Filter.Classes"}}</span>
                  </label>
                  {{/if}}
                </div>
                <div class='filter-actions'>
                  <button class='apply-filter-btn'>{{localize "DASU.Filter.Apply"}}</button>
                  <button class='clear-filter-btn'>{{localize "DASU.Filter.Clear"}}</button>
                </div>
              </div>
              <button class='items-favorites-btn {{#if favoriteFilterActive}}active{{/if}}' data-tooltip='{{#if favoriteFilterActive}}{{localize "DASU.Filter.ShowAll"}}{{else}}{{localize "DASU.Filter.ShowFavorites"}}{{/if}}' data-action='toggleFavoriteFilter'>
                <i class='{{#if favoriteFilterActive}}fas{{else}}far{{/if}} fa-star'></i>
              </button>
              <button class='items-edit-mode-btn {{#if isEditMode}}active{{/if}}' data-tooltip='{{#if isEditMode}}{{localize "DASU.Actor.EditMode.DisableTooltip"}}{{else}}{{localize "DASU.Actor.EditMode.EnableTooltip"}}{{/if}}' data-action='toggleEditMode'>
                <i class='fas {{#if isEditMode}}fa-eye-slash{{else}}fa-edit{{/if}}'></i>
              </button>
            </div>
          </li>

          {{! Include all item type sections }}
          {{! Weapons }}
          {{#if (or (eq itemFilterState null) (includes itemFilterState "weapon"))}}
          <li class='item flexrow items-header' data-item-type='weapon' data-sortable="true" draggable="true">
            <div class='item-name'>
<span class='item-name-text'>{{localize 'DASU.TYPES.Item.weapon'}}</span>
            </div>
            <div class='item-controls'>
              {{#if (and @root.editable @root.isEditMode)}}
                <a class='item-control item-create' data-tooltip='{{localize "DOCUMENT.Create" type="weapon"}}' data-action='createDoc' data-document-class='Item' data-type='weapon'>
                  <i class='fas fa-plus'></i>
                </a>
              {{/if}}
            </div>
          </li>
          <div class='item-list weapon-list'>
            {{#each weapons as |item id|}}
              <li class='item expandable-item' data-item-id='{{item._id}}' data-document-class='Item' draggable="true" data-sortable="true">
                <div class='item-row flexrow'>
                  <div class='item-name flexrow item-name-clickable' data-action='toggleDescription'>
                    <div class='item-image'>
                      <a class='rollable' data-action='roll' data-roll-type='item' >
                        <img src='{{item.img}}' data-tooltip='{{item.name}}{{#if item.isDaemonDerived}}<br>From: {{item.sourceDaemonName}}{{/if}}' width='24' height='24'/>
                      </a>
                    </div>
                    <span class='item-name-text'>{{item.name}}</span>
                    {{#if (includes item.traits 'innate')}}
                      <span class="badge innate-badge" title="{{localize 'DASU.Item.LevelGranted'}}">{{localize "DASU.Item.Innate"}}</span>
                    {{/if}}
                  </div>
                <div class='item-slots'>
                  {{#each item.system.tagSlots as |slot slotKey|}}
                    <div class='slot-indicator {{#if slot.tagId}}filled{{else}}empty{{/if}}' data-slot='{{slotKey}}' data-tooltip='{{#if slot.tagId}}{{#if item.slotTagData.[slotKey]}}{{item.slotTagData.[slotKey].name}}{{else}}{{slot.tagName}}{{/if}}{{else}}{{localize "DASU.Item.Slot.Empty"}}{{/if}}'>
                      {{#if slot.tagId}}
                        <i class='fas fa-tag'></i>
                        <span class='slot-tag-name'>
                          {{#if item.slotTagData.[slotKey]}}
                            {{item.slotTagData.[slotKey].name}}
                          {{else if slot.tagName}}
                            {{slot.tagName}}
                          {{else}}
                            {{localize "DASU.Item.Slot.Empty"}}
                          {{/if}}
                        </span>
                        {{#if item.slotTagData.[slotKey].isInvalid}}
                          <span class='invalid-tag-warning' data-tooltip='{{localize "DASU.Tag.InvalidTooltip"}}'>
                            <i class='fas fa-exclamation-triangle'></i>
                            <span>{{localize "DASU.Tag.Deleted"}}</span>
                          </span>
                        {{/if}}
                      {{else}}
                        <i class='fas fa-plus'></i>
                        <span class='slot-placeholder'>{{localize "DASU.Item.Slot.Empty"}}</span>
                      {{/if}}
                    </div>
                  {{/each}}
                </div>
                <div class='item-controls'>
                  <a class='item-control item-edit' data-tooltip='{{localize "DOCUMENT.Update" type="weapon"}}' data-action='viewDoc'>
                    <i class='fas {{#if (or (eq item.flags.dasu.grantedByLeveling true) (includes item.traits "innate") item.isDaemonDerived)}}fa-eye{{else}}fa-edit{{/if}}'></i>
                  </a>
                  {{#if (and @root.editable @root.isEditMode)}}
                    <a class='item-control item-delete' data-tooltip='{{localize "DASU.Item.DeleteWithoutConfirm"}}' data-action='deleteDocNoConfirm'>
                      <i class='fas fa-trash'></i>
                    </a>
                  {{/if}}
                  <a class='item-control context-menu-toggle' data-tooltip='{{localize "DASU.Item.MoreActions"}}'>
                    <i class='fas fa-bars'></i>
                  </a>
                </div>
                </div>
                <div class='item-description-row' style='display: none;'>
                  <div class='item-description-content'>
                    {{#if item.enrichedDescription}}{{{item.enrichedDescription}}}{{else}}<em>{{localize "DASU.Item.NoDescriptionAvailable"}}</em>{{/if}}
                  </div>
                </div>
              </li>
            {{/each}}
          </div>
          {{/if}}

          {{! Tags }}
          {{#if (or (eq itemFilterState null) (includes itemFilterState "tag"))}}
          <li class='item flexrow items-header' data-item-type='tag' data-sortable="true" draggable="true">
            <div class='item-name'>
<span class='item-name-text'>{{localize 'DASU.TYPES.Item.tag'}}</span>
            </div>
            <div class='item-controls'>
              {{#if (and @root.editable @root.isEditMode)}}
                <a class='item-control item-create' data-tooltip='{{localize "DOCUMENT.Create" type="tag"}}' data-action='createDoc' data-document-class='Item' data-type='tag'>
                  <i class='fas fa-plus'></i>
                </a>
              {{/if}}
            </div>
          </li>
          <div class='item-list tag-list'>
            {{#each tags as |item id|}}
              <li class='item expandable-item{{#if (isTagEquipped item @root.actor)}} equipped-tag{{/if}}' data-item-id='{{item._id}}' data-document-class='Item' draggable="true" data-drag-type="tag">
                <div class='item-row flexrow'>
                  <div class='item-name flexrow item-name-clickable' data-action='toggleDescription'>
                    <div class='item-image'>
                      <a class='rollable' data-action='roll' data-roll-type='item'>
                        <img src='{{item.img}}' data-tooltip='{{item.name}}' width='24' height='24'/>
                      </a>
                    </div>
                    <span class='item-name-text'>{{item.name}}</span>
                    {{#if (includes item.traits 'innate')}}
                      <span class="badge innate-badge" title="{{localize 'DASU.Item.LevelGranted'}}">{{localize "DASU.Item.Innate"}}</span>
                    {{/if}}
                    {{#if (isTagEquipped item @root.actor)}}
                      <span class='equipped-indicator' data-tooltip='{{localize "DASU.Tag.AlreadyEquipped"}}'>
                        <i class='fas fa-link'></i>
                      </span>
                    {{/if}}
                  </div>
                <div class='item-controls'>
                  <a class='item-control item-edit' data-tooltip='{{localize "DOCUMENT.Update" type="tag"}}' data-action='viewDoc'>
                    <i class='fas {{#if (or (eq item.flags.dasu.grantedByLeveling true) (includes item.traits "innate") item.isDaemonDerived)}}fa-eye{{else}}fa-edit{{/if}}'></i>
                  </a>
                  {{#if (and @root.editable @root.isEditMode)}}
                    <a class='item-control item-delete' data-tooltip='{{localize "DASU.Item.DeleteWithoutConfirm"}}' data-action='deleteDocNoConfirm'>
                      <i class='fas fa-trash'></i>
                    </a>
                  {{/if}}
                  <a class='item-control context-menu-toggle' data-tooltip='{{localize "DASU.Item.MoreActions"}}'>
                    <i class='fas fa-bars'></i>
                  </a>
                </div>
                </div>
                <div class='item-description-row' style='display: none;'>
                  <div class='item-description-content'>
                    {{#if item.enrichedDescription}}{{{item.enrichedDescription}}}{{else}}<em>{{localize "DASU.Item.NoDescriptionAvailable"}}</em>{{/if}}
                  </div>
                </div>
              </li>
            {{/each}}
          </div>
          {{/if}}

          {{! Techniques }}
          {{#if (or (eq itemFilterState null) (includes itemFilterState "technique"))}}
          <li class='item flexrow items-header' data-item-type='ability' data-system-category='technique' data-sortable="true" draggable="true">
            <div class='item-name'>
<span class='item-name-text'>{{localize 'DASU.Item.Ability.CATEGORIES.technique'}}</span>
            </div>
            <div class='item-actions'>
              {{localize "DASU.Item.Aptitude"}}
            </div>
            <div class='item-controls'>
              {{#if (and @root.editable @root.isEditMode)}}
                <a class='item-control item-create' data-tooltip='{{localize "DOCUMENT.Create" type="ability"}}' data-action='createDoc' data-document-class='Item' data-type='ability' data-system-category='technique'>
                  <i class='fas fa-plus'></i>
                </a>
              {{/if}}
            </div>
          </li>
          <div class='item-list technique-list'>
            {{#each techniques as |item id|}}
              <li class='item expandable-item' data-item-id='{{item._id}}' data-document-class='Item' draggable="true" data-sortable="true">
                <div class='item-row flexrow'>
                  <div class='item-name flexrow item-name-clickable' data-action='toggleDescription'>
                    <div class='item-image'>
                      <a class='rollable' data-action='roll' data-roll-type='item' >
                        <img src='{{item.img}}' data-tooltip='{{item.name}}{{#if item.isDaemonDerived}}<br>From: {{item.sourceDaemonName}}{{/if}}' width='24' height='24'/>
                      </a>
                    </div>
                    <span class='item-name-text'>{{item.name}}</span>
                    {{#if (includes item.traits 'innate')}}
                      <span class="badge innate-badge" title="{{localize 'DASU.Item.LevelGranted'}}">{{localize "DASU.Item.Innate"}}</span>
                    {{/if}}
                  </div>
                <div class='item-actions'>
                  <span class='aptitude-value' data-tooltip="{{localizeAptitudeTypeLong item.system.aptitudes.type}}<br>{{localize "DASU.Level"}} {{item.system.aptitudes.value}}">
                    {{#if item.system.aptitudes.type}}{{localizeAptitudeTypeShort item.system.aptitudes.type}}-{{item.system.aptitudes.value}}{{else}}N/A{{/if}}
                  </span>
                </div>
                <div class='item-controls'>
                  <a class='item-control item-edit' data-tooltip='{{localize "DOCUMENT.Update" type="technique"}}' data-action='viewDoc'>
                    <i class='fas {{#if (or (eq item.flags.dasu.grantedByLeveling true) (includes item.traits "innate") item.isDaemonDerived)}}fa-eye{{else}}fa-edit{{/if}}'></i>
                  </a>
                  {{#if (and @root.editable @root.isEditMode)}}
                    <a class='item-control item-delete' data-tooltip='{{localize "DASU.Item.DeleteWithoutConfirm"}}' data-action='deleteDocNoConfirm'>
                      <i class='fas fa-trash'></i>
                    </a>
                  {{/if}}
                  <a class='item-control context-menu-toggle' data-tooltip='{{localize "DASU.Item.MoreActions"}}'>
                    <i class='fas fa-bars'></i>
                  </a>
                </div>
                </div>
                <div class='item-description-row' style='display: none;'>
                  <div class='item-description-content'>
                    {{#if item.enrichedDescription}}{{{item.enrichedDescription}}}{{else}}<em>{{localize "DASU.Item.NoDescriptionAvailable"}}</em>{{/if}}
                  </div>
                </div>
              </li>
            {{/each}}
          </div>
          {{/if}}

          {{! Spells }}
          {{#if (or (eq itemFilterState null) (includes itemFilterState "spell"))}}
          <li class='item flexrow items-header' data-item-type='ability' data-system-category='spell' data-sortable="true" draggable="true">
            <div class='item-name'>
<span class='item-name-text'>{{localize 'DASU.Item.Ability.CATEGORIES.spell'}}</span>
            </div>
            <div class='item-actions'>
              {{localize "DASU.Item.Aptitude"}}
            </div>
            <div class='item-controls'>
              {{#if (and @root.editable @root.isEditMode)}}
                <a class='item-control item-create' data-tooltip='{{localize "DOCUMENT.Create" type="ability"}}' data-action='createDoc' data-document-class='Item' data-type='ability' data-system-category='spell'>
                  <i class='fas fa-plus'></i>
                </a>
              {{/if}}
            </div>
          </li>
          <div class='item-list spell-list'>
            {{#each spells as |item id|}}
              <li class='item expandable-item' data-item-id='{{item._id}}' data-document-class='Item' draggable="true" data-sortable="true">
                <div class='item-row flexrow'>
                  <div class='item-name flexrow item-name-clickable' data-action='toggleDescription'>
                    <div class='item-image'>
                      <a class='rollable' data-action='roll' data-roll-type='item' >
                        <img src='{{item.img}}' data-tooltip='{{item.name}}{{#if item.isDaemonDerived}}<br>From: {{item.sourceDaemonName}}{{/if}}' width='24' height='24'/>
                      </a>
                    </div>
                    <span class='item-name-text'>{{item.name}}</span>
                    {{#if (includes item.traits 'innate')}}
                      <span class="badge innate-badge" title="{{localize 'DASU.Item.LevelGranted'}}">{{localize "DASU.Item.Innate"}}</span>
                    {{/if}}
                  </div>
                <div class='item-actions'>
                  <span class='aptitude-value' data-tooltip="{{localizeAptitudeTypeLong item.system.aptitudes.type}}<br>{{localize "DASU.Level"}} {{item.system.aptitudes.value}}">
                    {{#if item.system.aptitudes.type}}{{localizeAptitudeTypeShort item.system.aptitudes.type}}-{{item.system.aptitudes.value}}{{else}}N/A{{/if}}
                  </span>
                </div>
                <div class='item-controls'>
                  <a class='item-control item-edit' data-tooltip='{{localize "DOCUMENT.Update" type="spell"}}' data-action='viewDoc'>
                    <i class='fas {{#if (or (eq item.flags.dasu.grantedByLeveling true) (includes item.traits "innate") item.isDaemonDerived)}}fa-eye{{else}}fa-edit{{/if}}'></i>
                  </a>
                  {{#if (and @root.editable @root.isEditMode)}}
                    <a class='item-control item-delete' data-tooltip='{{localize "DASU.Item.DeleteWithoutConfirm"}}' data-action='deleteDocNoConfirm'>
                      <i class='fas fa-trash'></i>
                    </a>
                  {{/if}}
                  <a class='item-control context-menu-toggle' data-tooltip='{{localize "DASU.Item.MoreActions"}}'>
                    <i class='fas fa-bars'></i>
                  </a>
                </div>
                </div>
                <div class='item-description-row' style='display: none;'>
                  <div class='item-description-content'>
                    {{#if item.enrichedDescription}}{{{item.enrichedDescription}}}{{else}}<em>{{localize "DASU.Item.NoDescriptionAvailable"}}</em>{{/if}}
                  </div>
                </div>
              </li>
            {{/each}}
          </div>
          {{/if}}

          {{! Afflictions }}
          {{#if (or (eq itemFilterState null) (includes itemFilterState "affliction"))}}
          <li class='item flexrow items-header' data-item-type='ability' data-system-category='affliction' data-sortable="true" draggable="true">
            <div class='item-name'>
<span class='item-name-text'>{{localize 'DASU.Item.Ability.CATEGORIES.affliction'}}</span>
            </div>
            <div class='item-actions'>
              {{localize "DASU.Item.Aptitude"}}
            </div>
            <div class='item-controls'>
              {{#if (and @root.editable @root.isEditMode)}}
                <a class='item-control item-create' data-tooltip='{{localize "DOCUMENT.Create" type="ability"}}' data-action='createDoc' data-document-class='Item' data-type='ability' data-system-category='affliction'>
                  <i class='fas fa-plus'></i>
                </a>
              {{/if}}
            </div>
          </li>
          <div class='item-list affliction-list'>
            {{#each afflictions as |item id|}}
              <li class='item expandable-item' data-item-id='{{item._id}}' data-document-class='Item' draggable="true" data-sortable="true">
                <div class='item-row flexrow'>
                  <div class='item-name flexrow item-name-clickable' data-action='toggleDescription'>
                    <div class='item-image'>
                      <a class='rollable' data-action='roll' data-roll-type='item'>
                        <img src='{{item.img}}' data-tooltip='{{item.name}}{{#if item.isDaemonDerived}}<br>From: {{item.sourceDaemonName}}{{/if}}' width='24' height='24'/>
                      </a>
                    </div>
                    <span class='item-name-text'>{{item.name}}</span>
                    {{#if (includes item.traits 'innate')}}
                      <span class="badge innate-badge" title="{{localize 'DASU.Item.LevelGranted'}}">{{localize "DASU.Item.Innate"}}</span>
                    {{/if}}
                  </div>
                <div class='item-actions'>
                  <span class='aptitude-value' data-tooltip="{{localizeAptitudeTypeLong item.system.aptitudes.type}}<br>{{localize "DASU.Level"}} {{item.system.aptitudes.value}}">
                    {{#if item.system.aptitudes.type}}{{localizeAptitudeTypeShort item.system.aptitudes.type}}-{{item.system.aptitudes.value}}{{else}}N/A{{/if}}
                  </span>
                </div>
                <div class='item-controls'>
                  <a class='item-control item-edit' data-tooltip='{{localize "DOCUMENT.Update" type="affliction"}}' data-action='viewDoc'>
                    <i class='fas {{#if (or (eq item.flags.dasu.grantedByLeveling true) (includes item.traits "innate") item.isDaemonDerived)}}fa-eye{{else}}fa-edit{{/if}}'></i>
                  </a>
                  {{#if (and @root.editable @root.isEditMode)}}
                    <a class='item-control item-delete' data-tooltip='{{localize "DASU.Item.DeleteWithoutConfirm"}}' data-action='deleteDocNoConfirm'>
                      <i class='fas fa-trash'></i>
                    </a>
                  {{/if}}
                  <a class='item-control context-menu-toggle' data-tooltip='{{localize "DASU.Item.MoreActions"}}'>
                    <i class='fas fa-bars'></i>
                  </a>
                </div>
                </div>
                <div class='item-description-row' style='display: none;'>
                  <div class='item-description-content'>
                    {{#if item.enrichedDescription}}{{{item.enrichedDescription}}}{{else}}<em>{{localize "DASU.Item.NoDescriptionAvailable"}}</em>{{/if}}
                  </div>
                </div>
              </li>
            {{/each}}
          </div>
          {{/if}}

          {{! Restoratives }}
          {{#if (or (eq itemFilterState null) (includes itemFilterState "restorative"))}}
          <li class='item flexrow items-header' data-item-type='ability' data-system-category='restorative' data-sortable="true" draggable="true">
            <div class='item-name'>
<span class='item-name-text'>{{localize 'DASU.Item.Ability.CATEGORIES.restorative'}}</span>
            </div>
            <div class='item-actions'>
              {{localize "DASU.Item.Aptitude"}}
            </div>
            <div class='item-controls'>
              {{#if (and @root.editable @root.isEditMode)}}
                <a class='item-control item-create' data-tooltip='{{localize "DOCUMENT.Create" type="ability"}}' data-action='createDoc' data-document-class='Item' data-type='ability' data-system-category='restorative'>
                  <i class='fas fa-plus'></i>
                </a>
              {{/if}}
            </div>
          </li>
          <div class='item-list restorative-list'>
            {{#each restoratives as |item id|}}
              <li class='item expandable-item' data-item-id='{{item._id}}' data-document-class='Item' draggable="true" data-sortable="true">
                <div class='item-row flexrow'>
                  <div class='item-name flexrow item-name-clickable' data-action='toggleDescription'>
                    <div class='item-image'>
                      <a class='rollable' data-action='roll' data-roll-type='item'>
                        <img src='{{item.img}}' data-tooltip='{{item.name}}{{#if item.isDaemonDerived}}<br>From: {{item.sourceDaemonName}}{{/if}}' width='24' height='24'/>
                      </a>
                    </div>
                    <span class='item-name-text'>{{item.name}}</span>
                    {{#if (includes item.traits 'innate')}}
                      <span class="badge innate-badge" title="{{localize 'DASU.Item.LevelGranted'}}">{{localize "DASU.Item.Innate"}}</span>
                    {{/if}}
                  </div>
                <div class='item-actions'>
                  <span class='aptitude-value' data-tooltip="{{localizeAptitudeTypeLong item.system.aptitudes.type}}<br>{{localize "DASU.Level"}} {{item.system.aptitudes.value}}">
                    {{#if item.system.aptitudes.type}}{{localizeAptitudeTypeShort item.system.aptitudes.type}}-{{item.system.aptitudes.value}}{{else}}N/A{{/if}}
                  </span>
                </div>
                <div class='item-controls'>
                  <a class='item-control item-edit' data-tooltip='{{localize "DOCUMENT.Update" type="restorative"}}' data-action='viewDoc'>
                    <i class='fas {{#if (or (eq item.flags.dasu.grantedByLeveling true) (includes item.traits "innate") item.isDaemonDerived)}}fa-eye{{else}}fa-edit{{/if}}'></i>
                  </a>
                  {{#if (and @root.editable @root.isEditMode)}}
                    <a class='item-control item-delete' data-tooltip='{{localize "DASU.Item.DeleteWithoutConfirm"}}' data-action='deleteDocNoConfirm'>
                      <i class='fas fa-trash'></i>
                    </a>
                  {{/if}}
                  <a class='item-control context-menu-toggle' data-tooltip='{{localize "DASU.Item.MoreActions"}}'>
                    <i class='fas fa-bars'></i>
                  </a>
                </div>
                </div>
                <div class='item-description-row' style='display: none;'>
                  <div class='item-description-content'>
                    {{#if item.enrichedDescription}}{{{item.enrichedDescription}}}{{else}}<em>{{localize "DASU.Item.NoDescriptionAvailable"}}</em>{{/if}}
                  </div>
                </div>
              </li>
            {{/each}}
          </div>
          {{/if}}

          {{! Tactics }}
          {{#if (or (eq itemFilterState null) (includes itemFilterState "tactic"))}}
          <li class='item flexrow items-header' data-item-type='tactic' data-sortable="true" draggable="true">
            <div class='item-name'>
<span class='item-name-text'>{{localize 'DASU.TYPES.Item.tactic'}}</span>
            </div>
            <div class='item-controls'>
              {{#if (and @root.editable @root.isEditMode)}}
                <a class='item-control item-create' data-tooltip='{{localize "DOCUMENT.Create" type="tactic"}}' data-action='createDoc' data-document-class='Item' data-type='tactic'>
                  <i class='fas fa-plus'></i>
                </a>
              {{/if}}
            </div>
          </li>
          <div class='item-list tactic-list'>
            {{#each tactics as |item id|}}
              <li class='item expandable-item' data-item-id='{{item._id}}' data-document-class='Item' draggable="true" data-sortable="true">
                <div class='item-row flexrow'>
                  <div class='item-name flexrow item-name-clickable' data-action='toggleDescription'>
                    <div class='item-image'>
                      <a class='rollable' data-action='roll' data-roll-type='item' >
                        <img src='{{item.img}}' data-tooltip='{{item.name}}{{#if item.isDaemonDerived}}<br>From: {{item.sourceDaemonName}}{{/if}}' width='24' height='24'/>
                      </a>
                    </div>
                    <span class='item-name-text'>{{item.name}}</span>
                    {{#if (includes item.traits 'innate')}}
                      <span class="badge innate-badge" title="{{localize 'DASU.Item.LevelGranted'}}">{{localize "DASU.Item.Innate"}}</span>
                    {{/if}}
                  </div>
                <div class='item-controls'>
                  <a class='item-control item-edit' data-tooltip='{{localize "DOCUMENT.Update" type="tactic"}}' data-action='viewDoc'>
                    <i class='fas {{#if (or (eq item.flags.dasu.grantedByLeveling true) (includes item.traits "innate") item.isDaemonDerived)}}fa-eye{{else}}fa-edit{{/if}}'></i>
                  </a>
                  {{#if (and @root.editable @root.isEditMode)}}
                    <a class='item-control item-delete' data-tooltip='{{localize "DASU.Item.DeleteWithoutConfirm"}}' data-action='deleteDocNoConfirm'>
                      <i class='fas fa-trash'></i>
                    </a>
                  {{/if}}
                  <a class='item-control context-menu-toggle' data-tooltip='{{localize "DASU.Item.MoreActions"}}'>
                    <i class='fas fa-bars'></i>
                  </a>
                </div>
                </div>
                <div class='item-description-row' style='display: none;'>
                  <div class='item-description-content'>
                    {{#if item.enrichedDescription}}{{{item.enrichedDescription}}}{{else}}<em>{{localize "DASU.Item.NoDescriptionAvailable"}}</em>{{/if}}
                  </div>
                </div>
              </li>
            {{/each}}
          </div>
          {{/if}}

          {{! Specials (available for both summoners and daemons) }}
          {{#if (or (eq itemFilterState null) (includes itemFilterState "special"))}}
          <li class='item flexrow items-header' data-item-type='special' data-sortable="true" draggable="true">
            <div class='item-name'>
<span class='item-name-text'>{{localize 'DASU.TYPES.Item.special'}}</span>
            </div>
            <div class='item-controls'>
              {{#if (and @root.editable @root.isEditMode)}}
                <a class='item-control item-create' data-tooltip='{{localize "DOCUMENT.Create" type="special"}}' data-action='createDoc' data-document-class='Item' data-type='special'>
                  <i class='fas fa-plus'></i>
                </a>
              {{/if}}
            </div>
          </li>
          <div class='item-list special-list'>
            {{#each specials as |item id|}}
              <li class='item expandable-item' data-item-id='{{item._id}}' data-document-class='Item' draggable="true" data-sortable="true">
                <div class='item-row flexrow'>
                  <div class='item-name flexrow item-name-clickable' data-action='toggleDescription'>
                    <div class='item-image'>
                      <a class='rollable' data-action='roll' data-roll-type='item'>
                        <img src='{{item.img}}' data-tooltip='{{item.name}}{{#if item.isDaemonDerived}}<br>From: {{item.sourceDaemonName}}{{/if}}' width='24' height='24'/>
                      </a>
                    </div>
                    <span class='item-name-text'>{{item.name}}</span>
                    {{#if (includes item.traits 'innate')}}
                      <span class="badge innate-badge" title="{{localize 'DASU.Item.LevelGranted'}}">{{localize "DASU.Item.Innate"}}</span>
                    {{/if}}
                  </div>
                  <div class='item-controls'>
                    <a class='item-control item-edit' data-tooltip='{{localize "DOCUMENT.Update" type="special"}}' data-action='viewDoc'>
                      <i class='fas {{#if (or (eq item.flags.dasu.grantedByLeveling true) (includes item.traits "innate") item.isDaemonDerived)}}fa-eye{{else}}fa-edit{{/if}}'></i>
                    </a>
                    {{#if (and @root.editable @root.isEditMode)}}
                      <a class='item-control item-delete' data-tooltip='{{localize "DASU.Item.DeleteWithoutConfirm"}}' data-action='deleteDocNoConfirm'>
                        <i class='fas fa-trash'></i>
                      </a>
                    {{/if}}
                    <a class='item-control context-menu-toggle' data-tooltip='{{localize "DASU.Item.MoreActions"}}'>
                      <i class='fas fa-bars'></i>
                    </a>
                  </div>
                </div>
                <div class='item-description-row' style='display: none;'>
                  <div class='item-description-content'>
                    {{#if item.enrichedDescription}}{{{item.enrichedDescription}}}{{else}}<em>{{localize "DASU.Item.NoDescriptionAvailable"}}</em>{{/if}}
                  </div>
                </div>
              </li>
            {{/each}}
          </div>
          {{/if}}

          {{! Scars (only for non-daemon actors) }}
          {{#if (ne actor.type 'daemon')}}
          {{#if (or (eq itemFilterState null) (includes itemFilterState "scar"))}}
          <li class='item flexrow items-header' data-item-type='scar' data-sortable="true" draggable="true">
            <div class='item-name'>
<span class='item-name-text'>{{localize 'DASU.TYPES.Item.scar'}}</span>
            </div>
            <div class='item-controls'>
              {{#if (and @root.editable @root.isEditMode)}}
                <a class='item-control item-create' data-tooltip='{{localize "DOCUMENT.Create" type="scar"}}' data-action='createDoc' data-document-class='Item' data-type='scar'>
                  <i class='fas fa-plus'></i>
                </a>
              {{/if}}
            </div>
          </li>
          <div class='item-list scar-list'>
            {{#each scars as |item id|}}
              <li class='item expandable-item' data-item-id='{{item._id}}' data-document-class='Item' draggable="true" data-sortable="true">
                <div class='item-row flexrow'>
                  <div class='item-name flexrow item-name-clickable' data-action='toggleDescription'>
                    <div class='item-image'>
                      <a class='rollable' data-action='roll' data-roll-type='item'>
                        <img src='{{item.img}}' data-tooltip='{{item.name}}{{#if item.isDaemonDerived}}<br>From: {{item.sourceDaemonName}}{{/if}}' width='24' height='24'/>
                      </a>
                    </div>
                    <span class='item-name-text'>{{item.name}}</span>
                    {{#if (includes item.traits 'innate')}}
                      <span class="badge innate-badge" title="{{localize 'DASU.Item.LevelGranted'}}">{{localize "DASU.Item.Innate"}}</span>
                    {{/if}}
                  </div>
                  <div class='item-controls'>
                    <a class='item-control item-edit' data-tooltip='{{localize "DOCUMENT.Update" type="scar"}}' data-action='viewDoc'>
                      <i class='fas {{#if (or (eq item.flags.dasu.grantedByLeveling true) (includes item.traits "innate") item.isDaemonDerived)}}fa-eye{{else}}fa-edit{{/if}}'></i>
                    </a>
                    {{#if (and @root.editable @root.isEditMode)}}
                      <a class='item-control item-delete' data-tooltip='{{localize "DASU.Item.DeleteWithoutConfirm"}}' data-action='deleteDocNoConfirm'>
                        <i class='fas fa-trash'></i>
                      </a>
                    {{/if}}
                    <a class='item-control context-menu-toggle' data-tooltip='{{localize "DASU.Item.MoreActions"}}'>
                      <i class='fas fa-bars'></i>
                    </a>
                  </div>
                </div>
                <div class='item-description-row' style='display: none;'>
                  <div class='item-description-content'>
                    {{#if item.enrichedDescription}}{{{item.enrichedDescription}}}{{else}}<em>{{localize "DASU.Item.NoDescriptionAvailable"}}</em>{{/if}}
                  </div>
                </div>
              </li>
            {{/each}}
          </div>
          {{/if}}
          {{/if}}

          {{! Schemas (only for summoners, not daemons) }}
          {{#if (and (ne actor.type 'daemon') (or (eq itemFilterState null) (includes itemFilterState "schema")))}}
          <li class='item flexrow items-header' data-item-type='schema' data-sortable="true" draggable="true">
            <div class='item-name'>
<span class='item-name-text'>{{localize 'DASU.TYPES.Item.schema'}}</span>
            </div>
            <div class='item-controls'>
              {{#if (and @root.editable @root.isEditMode)}}
                <a class='item-control item-create' data-tooltip='{{localize "DOCUMENT.Create" type="schema"}}' data-action='createDoc' data-document-class='Item' data-type='schema'>
                  <i class='fas fa-plus'></i>
                </a>
              {{/if}}
            </div>
          </li>
          <div class='item-list schema-list'>
            {{#each schemas as |item id|}}
              <li class='item expandable-item' data-item-id='{{item._id}}' data-document-class='Item' draggable="true" data-sortable="true">
                <div class='item-row flexrow'>
                  <div class='item-name flexrow item-name-clickable' data-action='toggleDescription'>
                    <div class='item-image'>
                      <a class='rollable' data-action='roll' data-roll-type='item'>
                        <img src='{{item.img}}' data-tooltip='{{item.name}}{{#if item.isDaemonDerived}}<br>From: {{item.sourceDaemonName}}{{/if}}' width='24' height='24'/>
                      </a>
                    </div>
                    <span class='item-name-text'>{{item.name}}</span>
                    {{#if (includes item.traits 'innate')}}
                      <span class="badge innate-badge" title="{{localize 'DASU.Item.LevelGranted'}}">{{localize "DASU.Item.Innate"}}</span>
                    {{/if}}
                  </div>
                  <div class='item-controls'>
                    <a class='item-control item-edit' data-tooltip='{{localize "DOCUMENT.Update" type="schema"}}' data-action='viewDoc'>
                      <i class='fas {{#if (or (eq item.flags.dasu.grantedByLeveling true) (includes item.traits "innate") item.isDaemonDerived (eq item.system.level 3))}}fa-eye{{else}}fa-edit{{/if}}'></i>
                    </a>
                    {{#if (and @root.editable @root.isEditMode)}}
                      {{#if (eq item.system.level 3)}}
                        <span class="item-level-label">{{localize "DASU.Level"}}: {{item.system.level}} / 3</span>
                      {{/if}}
                      <a class='item-control item-delete' data-tooltip='{{localize "DASU.Item.DeleteWithoutConfirm"}}' data-action='deleteDocNoConfirm'>
                        <i class='fas fa-trash'></i>
                      </a>
                    {{/if}}
                    <a class='item-control context-menu-toggle' data-tooltip='{{localize "DASU.Item.MoreActions"}}'>
                      <i class='fas fa-bars'></i>
                    </a>
                  </div>
                </div>
                <div class='item-description-row' style='display: none;'>
                  <div class='item-description-content'>
                    {{! Schema-specific level-based descriptions }}
                    <div class="schema-level-descriptions">
                      <div class="schema-level-description {{#if (gte item.system.level 1)}}active{{else}}inactive{{/if}}">
                        <div class="level-header">
                          <span class="level-number">Level 1</span>
                          {{#if (gte item.system.level 1)}}
                            <span class="level-status active">Active</span>
                          {{else}}
                            <span class="level-status inactive">Inactive</span>
                          {{/if}}
                        </div>
                        <div class="level-description-text">
                          {{#if item.system.level1.description}}
                            {{{item.system.level1.description}}}
                          {{else}}
                            <em>No description</em>
                          {{/if}}
                        </div>
                      </div>

                      <div class="schema-level-description {{#if (gte item.system.level 2)}}active{{else}}inactive{{/if}}">
                        <div class="level-header">
                          <span class="level-number">Level 2</span>
                          {{#if (gte item.system.level 2)}}
                            <span class="level-status active">Active</span>
                          {{else}}
                            <span class="level-status inactive">Inactive</span>
                          {{/if}}
                        </div>
                        <div class="level-description-text">
                          {{#if item.system.level2.description}}
                            {{{item.system.level2.description}}}
                          {{else}}
                            <em>No description</em>
                          {{/if}}
                        </div>
                      </div>

                      <div class="schema-level-description {{#if (gte item.system.level 3)}}active{{else}}inactive{{/if}}">
                        <div class="level-header">
                          <span class="level-number">Level 3</span>
                          {{#if (gte item.system.level 3)}}
                            <span class="level-status active">Active</span>
                          {{else}}
                            <span class="level-status inactive">Inactive</span>
                          {{/if}}
                        </div>
                        <div class="level-description-text">
                          {{#if item.system.level3.description}}
                            {{{item.system.level3.description}}}
                          {{else}}
                            <em>No description</em>
                          {{/if}}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
            {{/each}}
          </div>
          {{/if}}

          {{! Features (only for summoners, not daemons) }}
          {{#if (and (ne actor.type 'daemon') (or (eq itemFilterState null) (includes itemFilterState "feature")))}}
          <li class='item flexrow items-header' data-item-type='feature' data-sortable="true" draggable="true">
            <div class='item-name'>
<span class='item-name-text'>{{localize 'DASU.TYPES.Item.feature'}}</span>
            </div>
            <div class='item-controls'>
              {{#if (and @root.editable @root.isEditMode)}}
                <a class='item-control item-create' data-tooltip='{{localize "DOCUMENT.Create" type="feature"}}' data-action='createDoc' data-document-class='Item' data-type='feature'>
                  <i class='fas fa-plus'></i>
                </a>
              {{/if}}
            </div>
          </li>
          <div class='item-list feature-list'>
            {{#each features as |item id|}}
              <li class='item expandable-item' data-item-id='{{item._id}}' data-document-class='Item' draggable="true" data-sortable="true">
                <div class='item-row flexrow'>
                  <div class='item-name flexrow item-name-clickable' data-action='toggleDescription'>
                    <div class='item-image'>
                      <a class='rollable' data-action='roll' data-roll-type='item'>
                        <img src='{{item.img}}' data-tooltip='{{item.name}}{{#if item.isDaemonDerived}}<br>From: {{item.sourceDaemonName}}{{/if}}' width='24' height='24'/>
                      </a>
                    </div>
                    <span class='item-name-text'>{{item.name}}</span>
                    {{#if (includes item.traits 'innate')}}
                      <span class="badge innate-badge" title="{{localize 'DASU.Item.LevelGranted'}}">{{localize "DASU.Item.Innate"}}</span>
                    {{/if}}
                  </div>
                  <div class='item-controls'>
                    <a class='item-control item-edit' data-tooltip='{{localize "DOCUMENT.Update" type="feature"}}' data-action='viewDoc'>
                      <i class='fas {{#if (or (eq item.flags.dasu.grantedByLeveling true) (includes item.traits "innate") item.isDaemonDerived (eq item.system.level 3))}}fa-eye{{else}}fa-edit{{/if}}'></i>
                    </a>
                    {{#if (and @root.editable @root.isEditMode)}}
                      {{#if (eq item.system.level 3)}}
                        <span class="item-level-label">{{localize "DASU.Level"}}: {{item.system.level}} / 3</span>
                      {{/if}}
                      <a class='item-control item-delete' data-tooltip='{{localize "DASU.Item.DeleteWithoutConfirm"}}' data-action='deleteDocNoConfirm'>
                        <i class='fas fa-trash'></i>
                      </a>
                    {{/if}}
                    <a class='item-control context-menu-toggle' data-tooltip='{{localize "DASU.Item.MoreActions"}}'>
                      <i class='fas fa-bars'></i>
                    </a>
                  </div>
                </div>
                <div class='item-description-row' style='display: none;'>
                  <div class='item-description-content'>
                    {{#if item.enrichedDescription}}{{{item.enrichedDescription}}}{{else}}<em>{{localize "DASU.Item.NoDescriptionAvailable"}}</em>{{/if}}
                  </div>
                </div>
              </li>
            {{/each}}
          </div>
          {{/if}}

          {{! Classes (only for summoners, not daemons) }}
          {{#if (and (ne actor.type 'daemon') (or (eq itemFilterState null) (includes itemFilterState "class")))}}
          <li class='item flexrow items-header' data-item-type='class' data-sortable="true" draggable="true">
            <div class='item-name'>
<span class='item-name-text'>{{localize 'DASU.TYPES.Item.class'}}</span>
            </div>
            <div class='item-controls'>
              {{#if (and @root.editable @root.isEditMode)}}
                <a class='item-control item-create' data-tooltip='{{localize "DOCUMENT.Create" type="class"}}' data-action='createDoc' data-document-class='Item' data-type='class'>
                  <i class='fas fa-plus'></i>
                </a>
              {{/if}}
            </div>
          </li>
          <div class='item-list class-list'>
            {{#each classes as |item id|}}
              <li class='item expandable-item' data-item-id='{{item._id}}' data-document-class='Item' draggable="true" data-sortable="true">
                <div class='item-row flexrow'>
                  <div class='item-name flexrow item-name-clickable' data-action='toggleDescription'>
                    <div class='item-image'>
                      <a class='rollable' data-action='roll' data-roll-type='item' >
                        <img src='{{item.img}}' data-tooltip='{{item.name}}' width='24' height='24'/>
                      </a>
                    </div>
                    <span class='item-name-text'>{{item.name}}</span>
                  </div>
                  <div class='item-actions'>
                    <span class='class-category' data-tooltip="{{localize (concat "DASU.Class.Category." item.system.category)}}">
                      {{localize (concat "DASU.Class.Category." item.system.category)}}
                    </span>
                  </div>
                <div class='item-controls'>
                  <a class='item-control item-edit' data-tooltip='{{localize "DOCUMENT.Update" type="class"}}' data-action='viewDoc'>
                    <i class='fas fa-edit'></i>
                  </a>
                  {{#if (and @root.editable @root.isEditMode)}}
                    <a class='item-control item-delete' data-tooltip='{{localize "DASU.Item.DeleteWithoutConfirm"}}' data-action='deleteDocNoConfirm'>
                      <i class='fas fa-trash'></i>
                    </a>
                  {{/if}}
                  <a class='item-control context-menu-toggle' data-tooltip='{{localize "DASU.Item.MoreActions"}}'>
                    <i class='fas fa-bars'></i>
                  </a>
                </div>
                </div>
                <div class='item-description-row' style='display: none;'>
                  <div class='item-description-content'>
                    {{#if item.enrichedDescription}}{{{item.enrichedDescription}}}{{else}}<em>{{localize "DASU.Item.NoDescriptionAvailable"}}</em>{{/if}}
                  </div>
                </div>
              </li>
            {{/each}}
          </div>
          {{/if}}
        </ol>
      </aside>
    </main>
  </section>
</section>