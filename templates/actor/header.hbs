{{! =========================
    Sheet Header
    ========================= }}
<header class="sheet-header">
  {{! -- Portrait -- }}
  <div class="sheet-header-left">
    <img class="profile-img" src="{{actor.img}}" data-edit="img" data-action="editImage" data-tooltip="{{actor.name}}" height="100" width="100"/>
  </div>

  {{! -- Name and Bars -- }}
  <div class="sheet-header-center">
    <div class="document-name">
      <input name="name" type="text" value="{{actor.name}}" placeholder="{{localize 'DASU.Actor.Header.NamePlaceholder'}}"/>
    </div>
    <div class="sheet-header-bars">
      {{!-- Resource Bars --}}
      <div class="bars-container">
        {{!-- HP Bar with Temp --}}
        <div class="bar-group">
          <div class="temp-hp-section {{#unless system.stats.hp.temp}}empty{{/unless}}">
            <div class="temp-hp-bar">
              <div class="temp-fill" style="width: {{percent system.stats.hp.temp system.stats.hp.max}}%;"></div>
            </div>
            {{#if system.stats.hp.temp}}
              <span class="temp-value" data-tooltip="Temporary HP"><i class="fas fa-shield-alt"></i>{{system.stats.hp.temp}}</span>
            {{/if}}
          </div>
          <div class="bar-meter hp-bar">
            <span class="bar-label" data-action="manageResource" data-resource="hp">{{localize 'DASU.Actor.Stats.hp.label'}}</span>
            <div class="bar-outer">
              <div class="bar-inner" style="width: {{percent system.stats.hp.current system.stats.hp.max}}%;"></div>
            </div>
            <span class="bar-value">
              <input type="text" name="system.stats.hp.current" value="{{system.stats.hp.current}}" data-dtype="Number" class="bar-input" /> / {{system.stats.hp.max}}
            </span>
          </div>
        </div>
        {{!-- WP Bar with Temp --}}
        <div class="bar-group">
          <div class="temp-hp-section {{#unless system.stats.wp.temp}}empty{{/unless}}">
            <div class="temp-hp-bar">
              <div class="temp-fill" style="width: {{percent system.stats.wp.temp system.stats.wp.max}}%;"></div>
            </div>
            {{#if system.stats.wp.temp}}
              <span class="temp-value" data-tooltip="Temporary WP"><i class="fas fa-shield-alt"></i>{{system.stats.wp.temp}}</span>
            {{/if}}
          </div>
          <div class="bar-meter wp-bar">
            <span class="bar-label" data-action="manageResource" data-resource="wp">{{localize 'DASU.Actor.Stats.wp.label'}}</span>
            <div class="bar-outer">
              <div class="bar-inner" style="width: {{percent system.stats.wp.current system.stats.wp.max}}%;"></div>
            </div>
            <span class="bar-value">
              <input type="text" name="system.stats.wp.current" value="{{system.stats.wp.current}}" data-dtype="Number" class="bar-input" /> / {{system.stats.wp.max}}
            </span>
          </div>
        </div>
      </div>
      {{!-- Defense Stats --}}
      <div class="stats-container">
        {{!-- Avoid Stat --}}
        <div class="stat-display">
          <span class="stat-label" data-tooltip="{{localize 'DASU.Actor.Stats.avoid.tooltip'}}">{{localize 'DASU.Actor.Stats.avoid.label'}}</span>
          <span class="stat-value">{{system.stats.avoid.value}}</span>
        </div>
        {{!-- Defense Stat --}}
        <div class="stat-display">
          <span class="stat-label" data-tooltip="{{localize 'DASU.Actor.Stats.def.tooltip'}}">{{localize 'DASU.Actor.Stats.def.label'}}</span>
          <span class="stat-value">{{system.stats.def.value}}</span>
        </div>
      </div>
    </div>
  </div>

  {{! -- Level and Merit -- }}
  <div class="sheet-header-right">
    <div class="level-box">
      <div class="level-row">
        <span class="level-label">{{localize 'DASU.Level'}}</span>
        {{#if (and actor.type (eq actor.type 'summoner'))}}
          {{!-- Summoner: Show level as text with leveling wizard button --}}
          <span class="level-value">{{system.level}}</span>
          {{!-- Debug canLevelUp: {{canLevelUp}} --}}
          {{#if editable}}
            <button type="button" class="leveling-wizard-btn {{#if canLevelUp}}can-level-up{{/if}}" data-action="openLevelingWizard" data-tooltip="{{localize 'DASU.Actor.levelingWizard.tooltip'}}">
              <i class="fas fa-level-up-alt"></i>
            </button>
          {{/if}}
        {{else if (and actor.type (eq actor.type 'daemon'))}}
          {{!-- Daemon: Show level as editable input field --}}
          <input type="number" name="system.level" value="{{system.level}}" data-dtype="Number" class="level-input" min="1" max="30" />
        {{else}}
          {{!-- Fallback for other actor types --}}
          <span class="level-value">{{system.level}}</span>
        {{/if}}
      </div>
      <div class="merit-row">
        <span class="merit-label">{{localize 'DASU.Actor.Header.Merit'}}</span>
        <input type="text" name="system.merit" value="{{system.merit}}" data-dtype="Number" class="merit-input" />
      </div>
    </div>
    {{#if (or (eq actor.type 'summoner') (eq actor.type 'daemon'))}}
      <div class="initiative-box">
        <button type="button" class="initiative-btn" data-action="rollInitiative" data-tooltip="{{localize 'DASU.InitiativeTooltip'}}">
          <i class="fas fa-dice-d6"></i>
          <span>{{localize 'DASU.Initiative'}}</span>
        </button>
      </div>
    {{/if}}
  </div>

  {{! -- Resistances Row -- }}
  <div class="resistances-row">
    {{#if system.resistances}}
      {{#each system.resistances as |resistance key|}}
        <div class="resistance-display {{#if @root.isEditMode}}resistance-edit-mode{{/if}}" data-resistance="{{key}}" data-tooltip="{{resistance.label}}: {{resistance.resTypeCurr}}">
          <img class="resistance-icon"
               src="systems/dasu/assets/static/resistances/{{key}}.png"
               alt="{{key}}" />
          {{#if @root.isEditMode}}
            <select name="system.resistances.{{key}}.base"
                    class="resistance-select"
                    data-dtype="Number"
                    data-tooltip="{{resistance.label}}: {{resistance.resTypeBase}}">
              {{selectOptions @root.config.resTypeAbbr selected=resistance.base localize=true}}
            </select>
          {{else}}
            <span class="resistance-value">{{resistance.resTypeCurrAbbr}}</span>
          {{/if}}
        </div>
      {{/each}}
    {{/if}}
  </div>
</header>