{{! Biography Tab }}
<section class='tab biography scrollable {{tab.cssClass}}' data-group='primary' data-tab='biography'>
  <section class='grid grid-3col' style="height: 100%;">
    <aside class='sidebar grid-span-1'>
      {{#if (eq actor.type "daemon")}}
        {{#if @root.isEditMode}}
          {{! Edit Mode - Full item list with controls }}
          <div class='card-container drop-target' data-drop-target style='background: var(--color-bg-primary); border: 1px solid var(--color-border); padding: 0.5rem; margin-bottom: 0.5rem;'>
            <h4 class="section-header" style="margin-bottom: 0.25rem;">{{localize 'DASU.Actor.DaemonTypes.Header'}}</h4>

            {{! Archetype }}
            <div class="daemon-type-slot drop-target" data-drop-target>
              <div class="flexrow" style="align-items: center; justify-content: space-between; margin-bottom: 0.25rem;">
                <label class="resource-label" style="font-weight: 600;">{{localize 'DASU.Item.Archetype.label'}}</label>
                <div class="item-controls">
                  <a class="item-control item-create" data-action="createDoc" data-document-class="Item" data-type="archetype" data-tooltip="{{localize 'DASU.Item.Create' name=(localize 'DASU.Item.Archetype.label')}}">
                    <i class="fas fa-plus"></i>
                  </a>
                </div>
              </div>
              {{#each (filterItems items "archetype") as |item|}}
                <li class="item flexrow draggable" data-document-class="Item" data-item-id="{{item._id}}" draggable="true" style="list-style: none; margin-bottom: 0.25rem;">
                  <div class="item-image rollable" data-action="viewDoc" data-uuid="{{item.uuid}}" data-tooltip="{{item.name}}">
                    <img src="{{item.img}}" alt="{{item.name}}" />
                  </div>
                  <h4 class="item-name">{{item.name}}</h4>
                  <div class="item-controls">
                    <a class="item-control" data-action="viewDoc" data-uuid="{{item.uuid}}" data-tooltip="{{localize 'SHEETS.ItemEdit'}}"><i class="fas fa-edit"></i></a>
                    <a class="item-control" data-action="deleteDoc" data-uuid="{{item.uuid}}" data-tooltip="{{localize 'DASU.Delete'}}"><i class="fas fa-trash"></i></a>
                  </div>
                </li>
              {{else}}
                <div class="empty-slot" style="font-style: italic; opacity: 0.6; margin-bottom: 0.25rem;">{{localize 'DASU.Item.Archetype.empty'}}</div>
              {{/each}}
            </div>

            {{! Subtype }}
            <div class="daemon-type-slot drop-target" data-drop-target style="margin-top: 0.5rem;">
              <div class="flexrow" style="align-items: center; justify-content: space-between; margin-bottom: 0.25rem;">
                <label class="resource-label" style="font-weight: 600;">{{localize 'DASU.Item.Subtype.label'}}</label>
                <div class="item-controls">
                  <a class="item-control item-create" data-action="createDoc" data-document-class="Item" data-type="subtype" data-tooltip="{{localize 'DASU.Item.Create' name=(localize 'DASU.Item.Subtype.label')}}">
                    <i class="fas fa-plus"></i>
                  </a>
                </div>
              </div>
              {{#each (filterItems items "subtype") as |item|}}
                <li class="item flexrow draggable" data-document-class="Item" data-item-id="{{item._id}}" draggable="true" style="list-style: none; margin-bottom: 0.25rem;">
                  <div class="item-image rollable" data-action="viewDoc" data-uuid="{{item.uuid}}" data-tooltip="{{item.name}}">
                    <img src="{{item.img}}" alt="{{item.name}}" />
                  </div>
                  <h4 class="item-name">{{item.name}}</h4>
                  <div class="item-controls">
                    <a class="item-control" data-action="viewDoc" data-uuid="{{item.uuid}}" data-tooltip="{{localize 'SHEETS.ItemEdit'}}"><i class="fas fa-edit"></i></a>
                    <a class="item-control" data-action="deleteDoc" data-uuid="{{item.uuid}}" data-tooltip="{{localize 'DASU.Delete'}}"><i class="fas fa-trash"></i></a>
                  </div>
                </li>
              {{else}}
                <div class="empty-slot" style="font-style: italic; opacity: 0.6; margin-bottom: 0.25rem;">{{localize 'DASU.Item.Subtype.empty'}}</div>
              {{/each}}
            </div>

            {{! Roles }}
            <div class="daemon-type-slot drop-target" data-drop-target style="margin-top: 0.5rem;">
              <div class="flexrow" style="align-items: center; justify-content: space-between; margin-bottom: 0.25rem;">
                <label class="resource-label" style="font-weight: 600;">{{localize 'DASU.Item.Role.label'}}</label>
                <div class="item-controls">
                  <a class="item-control item-create" data-action="createDoc" data-document-class="Item" data-type="role" data-tooltip="{{localize 'DASU.Item.Create' name=(localize 'DASU.Item.Role.label')}}">
                    <i class="fas fa-plus"></i>
                  </a>
                </div>
              </div>
              {{#each (filterItems items "role") as |item|}}
                <li class="item flexrow draggable" data-document-class="Item" data-item-id="{{item._id}}" draggable="true" style="list-style: none; margin-bottom: 0.25rem;">
                  <div class="item-image rollable" data-action="viewDoc" data-uuid="{{item.uuid}}" data-tooltip="{{item.name}}">
                    <img src="{{item.img}}" alt="{{item.name}}" />
                  </div>
                  <h4 class="item-name">{{item.name}}</h4>
                  <div class="item-controls">
                    <a class="item-control" data-action="viewDoc" data-uuid="{{item.uuid}}" data-tooltip="{{localize 'SHEETS.ItemEdit'}}"><i class="fas fa-edit"></i></a>
                    <a class="item-control" data-action="deleteDoc" data-uuid="{{item.uuid}}" data-tooltip="{{localize 'DASU.Delete'}}"><i class="fas fa-trash"></i></a>
                  </div>
                </li>
              {{else}}
                <div class="empty-slot" style="font-style: italic; opacity: 0.6;">{{localize 'DASU.Item.Role.empty'}}</div>
              {{/each}}
            </div>
          </div>
        {{else}}
          {{! Preview Mode - Compact view with just names }}
          <div class='card-container' style='background: var(--color-bg-primary); border: 1px solid var(--color-border); padding: 0.2rem 0.4rem; align-items: center; min-height: 1.4rem; margin-bottom: 0.5rem;'>
            <h4 class="section-header">{{localize 'DASU.Actor.DaemonTypes.Header'}}</h4>

            {{! Archetype }}
            <div class="triad-field flexrow">
              <label class="resource-label">{{localize 'DASU.Item.Archetype.label'}}:</label>
              {{#each (filterItems items "archetype") as |item|}}
                <li data-document-class="Item" data-item-id="{{item._id}}" style="list-style: none;">
                  <span class="field-value rollable" data-action="viewDoc" data-uuid="{{item.uuid}}" style="cursor: pointer;">{{item.name}}</span>
                </li>
              {{else}}
                <span class="field-value" style="font-style: italic; opacity: 0.6;">{{localize 'DASU.Item.Archetype.empty'}}</span>
              {{/each}}
            </div>

            {{! Subtype }}
            <div class="triad-field flexrow">
              <label class="resource-label">{{localize 'DASU.Item.Subtype.label'}}:</label>
              {{#each (filterItems items "subtype") as |item|}}
                <li data-document-class="Item" data-item-id="{{item._id}}" style="list-style: none;">
                  <span class="field-value rollable" data-action="viewDoc" data-uuid="{{item.uuid}}" style="cursor: pointer;">{{item.name}}</span>
                </li>
              {{else}}
                <span class="field-value" style="font-style: italic; opacity: 0.6;">{{localize 'DASU.Item.Subtype.empty'}}</span>
              {{/each}}
            </div>

            {{! Roles }}
            <div class="triad-field flexrow">
              <label class="resource-label">{{localize 'DASU.Item.Role.label'}}:</label>
              <span class="field-value">
                {{#each (filterItems items "role") as |item|}}
                  <li data-document-class="Item" data-item-id="{{item._id}}" style="list-style: none; display: inline;">
                    <span class="rollable" data-action="viewDoc" data-uuid="{{item.uuid}}" style="cursor: pointer;">{{item.name}}{{#unless @last}}, {{/unless}}</span>
                  </li>
                {{else}}
                  <span style="font-style: italic; opacity: 0.6;">{{localize 'DASU.Item.Role.empty'}}</span>
                {{/each}}
              </span>
            </div>
          </div>
        {{/if}}
      {{/if}}

      {{! Moral Triad Section }}
      <div class='card-container'
        style='background: var(--color-bg-primary); border: 1px solid var(--color-border); padding: 0.2rem 0.4rem; align-items: center; min-height: 1.4rem; margin-bottom: 0.5rem;'>
        <h4 class="section-header">{{localize 'DASU.Actor.Triad.Header'}}</h4>
        <div class="triad-field flexrow">
          <label class="resource-label" for='triad-virtue'>{{localize 'DASU.Actor.Triad.Virtue'}}:</label>
          {{#if @root.isEditMode}}
          <input type='text' id='triad-virtue' list='virtue-suggestions' name='system.triad.virtue'
            value='{{system.triad.virtue}}' placeholder='Enter a virtue...' />
          {{else}}
          <span class="field-value">{{system.triad.virtue}}</span>
          {{/if}}
        </div>
        <div class="triad-field flexrow">
          <label class="resource-label" for='triad-sin'>{{localize 'DASU.Actor.Triad.Sin'}}:</label>
          {{#if @root.isEditMode}}
          <input type='text' id='triad-sin' list='sin-suggestions' name='system.triad.sin' value='{{system.triad.sin}}'
            placeholder='Enter a sin...' />
          {{else}}
          <span class="field-value">{{system.triad.sin}}</span>
          {{/if}}
        </div>
        <div class="triad-field flexrow">
          <label class="resource-label" for='triad-anathema'>{{localize 'DASU.Actor.Triad.Anathema'}}:</label>
          {{#if @root.isEditMode}}
          <input type='text' id='triad-anathema' list='anathema-suggestions' name='system.triad.anathema'
            value='{{system.triad.anathema}}' placeholder='Enter an anathema...' />
          {{else}}
          <span class="field-value">{{system.triad.anathema}}</span>
          {{/if}}
        </div>
      </div>

      {{! Datalist suggestions for moral triad fields }}
      <datalist id='virtue-suggestions'>
        <option value='Ambition'>
        <option value='Cunning'>
        <option value='Passion'>
        <option value='Competition'>
        <option value='Yearning'>
        <option value='Indulgence'>
        <option value='Certainty'>
        <option value='Comfort'>
        <option value='Devotion'>
        <option value='Discernment'>
        <option value='Conviction'>
        <option value='Aspiration'>
      </datalist>

      <datalist id='sin-suggestions'>
        <option value='Pride'>
        <option value='Greed'>
        <option value='Wrath'>
        <option value='Envy'>
        <option value='Lust'>
        <option value='Gluttony'>
        <option value='Sloth'>
        <option value='Ignorance'>
        <option value='Attachment'>
        <option value='Aversion'>
        <option value='Delusion'>
        <option value='Obsession'>
      </datalist>

      <datalist id='anathema-suggestions'>
        <option value='Dishonor'>
        <option value='Disgrace'>
        <option value='Poverty'>
        <option value='Helplessness'>
        <option value='Insignificance'>
        <option value='Sterility'>
        <option value='Starvation'>
        <option value='Paralysis'>
        <option value='Confusion'>
        <option value='Subjugation'>
        <option value='Blindness'>
        <option value='Emptiness'>
      </datalist>
    </aside>

    <main class='main-content grid-span-2'>
      <div class='card-container'
        style='height: 100%; background: var(--color-bg-primary); border: 1px solid var(--color-border); padding: 0.2rem 0.4rem; align-items: center; min-height: 1.4rem; margin-bottom: 0.5rem;'>
        <fieldset class='biography-description' style="height: 100%;">
          <legend>{{systemFields.biography.label}}</legend>
          {{formInput @root.htmlInputField value=system.biography name="system.biography" toggled=@root.editable
          enriched=enrichedBiography disabled=(not @root.editable)}}
        </fieldset>
      </div>
    </main>
  </section>
</section>